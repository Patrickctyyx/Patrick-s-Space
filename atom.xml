<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Patrick&#39;s Space</title>
  <subtitle>Stay hungry, stay foolish!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.patrickcty.cc/"/>
  <updated>2018-03-14T01:21:59.783Z</updated>
  <id>https://blog.patrickcty.cc/</id>
  
  <author>
    <name>Patrick</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>春节档电影</title>
    <link href="https://blog.patrickcty.cc/2018/03/14/%E6%98%A5%E8%8A%82%E6%A1%A3%E7%94%B5%E5%BD%B1/"/>
    <id>https://blog.patrickcty.cc/2018/03/14/春节档电影/</id>
    <published>2018-03-14T01:21:02.000Z</published>
    <updated>2018-03-14T01:21:59.783Z</updated>
    
    <content type="html"><![CDATA[<p>春节档电影总是有限，这次一共有四部，其中西游记题材的真的是看烂了，于我而言完全没有观看的欲望。另外的三部中我看了两部，这两部都给了我相应的惊喜。</p>
<p>首先看的是《唐2》，整部电影的节奏把握得很好，观众看起来比较畅快，里面的喜剧元素也让人比较轻松，刘昊然推理时候的场景简直科技感炸裂，看得也非常过瘾。剧情方面在看的时候也没发现明显的槽点，不过事后看大家的评论才知道原来推理有这么多漏洞 233，不过作为一个非推理迷，剧情还是比较让人满意的。评分的话我个人觉得可以有 8/10。</p>
<p>接下来看的是《红海》，这一部是春节档中口碑最好的一部，看完之后觉得真的很良心，战斗场面逼真度极高且恢弘，人物表现丰满，就是整体一直维持在高强度的节奏看完之后个人感觉很累……还有给血腥场面的特写真的有点尺度太大了啊……整体评分的话 8.5/10，不适合带着孩子老人去看，一部不作的主旋律好片。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;春节档电影总是有限，这次一共有四部，其中西游记题材的真的是看烂了，于我而言完全没有观看的欲望。另外的三部中我看了两部，这两部都给了我相应的惊喜。&lt;/p&gt;
&lt;p&gt;首先看的是《唐2》，整部电影的节奏把握得很好，观众看起来比较畅快，里面的喜剧元素也让人比较轻松，刘昊然推理时候的场
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="喜剧" scheme="https://blog.patrickcty.cc/tags/%E5%96%9C%E5%89%A7/"/>
    
      <category term="战争片" scheme="https://blog.patrickcty.cc/tags/%E6%88%98%E4%BA%89%E7%89%87/"/>
    
  </entry>
  
  <entry>
    <title>《黑豹》</title>
    <link href="https://blog.patrickcty.cc/2018/03/14/%E3%80%8A%E9%BB%91%E8%B1%B9%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2018/03/14/《黑豹》/</id>
    <published>2018-03-14T01:14:26.000Z</published>
    <updated>2018-03-14T01:17:26.329Z</updated>
    
    <content type="html"><![CDATA[<p>对我来说，看电影的话，要看就要看好电影，但这好电影的标准不知何时已经变成了让我觉得有意思的电影，而相对的，电影的逻辑严密性，主题反而没那么重要了。</p>
<p>而这部《黑豹》，对我来说则无疑是一部好电影。整部电影最精彩的部分就是瓦坎达的科技了，因为有了万能的振金，被外界视作贫困潦倒的第三世界国家实际上是一个科技高度发达的不为外界所知的文明国度。</p>
<p>不得不说振金的设定真的非常巧妙，影片中出现的能远程驾驶的控制器，能防止子弹和碰撞的汽车，自由伸缩的长矛，可以掀翻无敌汽车的手部“空气炮”，看似毛毯却可以当做盾牌的奇妙物件以及强度甚至比钢铁侠战甲还要高的黑豹战斗服（最重要的是不用躲在角落换衣服了 233），这些科技产物绝对是一场视觉盛宴，极具观赏性。</p>
<p>而剧情方面就没有科技来得那么精彩了，因为电影的核心所在应该是想要表达的主题：能力越大，责任越大，与其独善其身，更应兼济天下。而大反派就是因为前代想“独善其身”而造成的畸形产物，主角的任务就是弥补父亲以前的错误。也正是因为主题，影片中花大量的篇幅引导我们思考是应该独善其身还是应该站出来兼济天下，而大反派的戏份也因此比较有限，与主角的碰撞也比较草率地结束了，尽管反派塑造的很好很有魅力，但却有虎头蛇尾的嫌疑。</p>
<p>有一个问题是主角团这边形象没有其他的漫威电影来得高大，主角的魅力也没怎么凸显出来，至少远远没有《美国队长 1》那么好，不过后面的《复仇者联盟 3》黑豹还有不少戏份，希望到时候黑豹的形象能更加丰满高大。</p>
<p>评分 8/10，影片中的高科技元素是家分店，主题的表达也是可圈可点，但是因此而削弱了人物形象的塑造有点得不偿失。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;对我来说，看电影的话，要看就要看好电影，但这好电影的标准不知何时已经变成了让我觉得有意思的电影，而相对的，电影的逻辑严密性，主题反而没那么重要了。&lt;/p&gt;
&lt;p&gt;而这部《黑豹》，对我来说则无疑是一部好电影。整部电影最精彩的部分就是瓦坎达的科技了，因为有了万能的振金，被外界视
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="超级英雄" scheme="https://blog.patrickcty.cc/tags/%E8%B6%85%E7%BA%A7%E8%8B%B1%E9%9B%84/"/>
    
      <category term="漫威" scheme="https://blog.patrickcty.cc/tags/%E6%BC%AB%E5%A8%81/"/>
    
  </entry>
  
  <entry>
    <title>《奇迹男孩》</title>
    <link href="https://blog.patrickcty.cc/2018/01/31/%E3%80%8A%E5%A5%87%E8%BF%B9%E7%94%B7%E5%AD%A9%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2018/01/31/《奇迹男孩》/</id>
    <published>2018-01-31T15:56:44.000Z</published>
    <updated>2018-01-31T15:59:23.358Z</updated>
    
    <content type="html"><![CDATA[<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>当你因为先天缺陷而导致面容与常人不同时，你是选择封闭自己还是敞开怀抱？当你的孩子你因为先天缺陷而导致面容与常人不同时，你会怎样对待他？当你拥有一个因为先天缺陷而导致面容与常人不同的弟弟，而且这个弟弟从父母那里剥夺走了原本属于你的爱与关心，你会怎么做？如果你遇到了这样的同学，他因为先天缺陷而导致面容与常人不同，你会怎么对待他？</p>
<p>影片对这些问题进行了探讨，交出来的答卷确实也相当有水平。</p>
<p>首先我们从父母的角度来看。对于这样与众不同的孩子，他们并没有一到年龄就将他交给学校，我想他们也明白，童年产生的阴影可能会影响一辈子，因而他们选择在家里对孩子进行早教，同时在这个过程中也仍保留着对孩子性格的引导——让他知道他仍是一个正常孩子。这些举措确实有效，不仅给了他一个相对快乐的童年，还进行了充分的积累来让他能相对安稳地踏进真正的社会。</p>
<p>而这一天也终于到来，影片中说得很有道理的一点是：在某些方面，成年人社会比小孩社会要好过，因为小孩不懂得隐藏自己的情绪，而小孩子面对与自己不同的事物，通常采取的措施是排斥、孤立与嘲笑。因而校园霸凌与孤立成为了奥吉面临的最大的问题，而这些问题是普遍存在于所有的中小学学校中的。</p>
<p>我记得在小学的时候，我们班有一个吴同学，可能因为他是务工子弟的儿子，他身上的衣服和鞋子总是感觉破破烂烂的，并有些脏，也有一些同学说他“臭”，但这臭是否是真实存在的我其实也不清楚。就是因为他的这些不同之处，他受到了我们班的一些不良同学的排挤，就像是电影里的朱利安所做的类似的事情。我们都知道，为了合群或是出于其他的一些原因，学校中跟风的行为非常普遍，我也因此对吴同学采取疏远的态度，甚至有一次还将他推下了升旗台……但尽管如此，在之后我还去他家玩过，也曾有一段时间和他在一起玩，虽然关系并没有密切到和电影中杰克与奥吉的关系那样。因为不想成为被孤立的人，我也加入了孤立他的人群中，而我们班其他同学的想法似乎和我也相同，因此吴同学自始至终都受到了排挤与霸凌。</p>
<p>我们的奥吉在进学校之际就因为外貌而遭受了类似的对待，但和吴同学不同的是，在受到排挤之际，有同学不害怕也被孤立，站了出来和奥吉交朋友，也正是在这个过程中，奥吉自身的优点也为人所知，其他人也不再因为他的与众不同外貌而排斥他了。</p>
<p>首先站出来的是杰克威尔，但是他依然害怕被孤立，因而在他和朱利安他们一起的时候说出了迎合他们的话语，而正是这句话是深深刺痛了奥吉的内心；真正让奥吉敞开心扉的是莎莫，比起杰克是因为奥吉的帮助而开始与他相处，莎莫是在奥吉最为脆弱的时候出现在了奥吉的身边，并让奥吉知道了友谊的真正感觉，同时也将他从背叛的阴影之中解救出来。</p>
<p>如果当时我们班里面有人更勇敢一点，如果那个勇敢的人就是我，那么就可以让吴同学的小学生活更加好一点，只是合群的魔爪钳住了我们，将我们和吴同学放在了对立的位置……</p>
<p>接着我们来到姐姐的角度。一般在拥有多个孩子的家庭里面，最受宠的都是最小的那个。在本部影片中，更小的孩子还拥有先天缺陷而需要父母亲更多的关爱，因而姐姐得到的爱就更少了。尽管我是独生子女不存在这样的问题，但是如果让我面临这样的情况那我的内心一定相当郁闷甚至导致我不给弟弟好脸色看。然而影片中的姐姐隐藏了自己的情绪，一方面不给爸爸妈妈添麻烦，另一方面又尽自己所能来照顾与众不同的弟弟。</p>
<p>姐姐这部分最让我印象深刻的是在万圣节的这天，本来是她和妈妈的独处被弟弟所破坏，尽管姐姐很生气，但是面对更加伤心的弟弟，她压下了自己的情绪，而去想方设法安慰弟弟，让他走出家门，走出了郁闷。由此看来弟弟的健康成长中姐姐也是功不可没的呢。</p>
<p>虽然姐姐足够好，但是这部分父母亲还是有点失职，即使有个特殊的孩子要照顾，但也不能忽视了那个乖巧懂事的另一个孩子的存在，尽管那个孩子看起来足够坚强，似乎并不需要心疼。姐姐的那场演出让父母知道了他们一直忽视的姐姐的优秀，也让他们察觉到了他们所存在的对姐姐的关心太少的问题。</p>
<p>接下来则是米兰达的角度。米兰达突然的冷漠态度原来是为了圆上自己身世的幌子，而正是这个身世，让米兰达在夏令营中成为最受欢迎的人。这无疑也是群体中经常出现的另一个问题，每个人都想受到其他人的关注，而这份关注需要相应的基础来支撑，如果没有相应的基础则需要一定的代价来进行交换，米兰达交换的筹码则是自己最真挚的友谊。但在经历了那么多之后，米兰达终于明白了，最珍贵的应该是友谊，而不是那泡沫般的受欢迎，也正是米兰达的醒悟，让姐姐得以在家人面前展示自己从而让父母认识到了自己一直以来对姐姐的忽视。</p>
<p>影片是从多个人物的角度来讲述故事，不过主要的故事都围绕在奥吉的身上。这样的讲述手法给故事设置了很多矛盾冲突，又在之后一一进行解决，让故事充满波折又引人思考，除此之外，影片对我一开始提的问题的思考也非常深刻，是一部非常用心的影片。</p>
<p>插点题外话，这部电影是我和我表弟一起看的，看的时候电影院中基本上都是家长带着孩子看。一开始我还以为这会是一部非常扯的亲子向电影，但最终看下来我实在是收获良多。</p>
<h2 id="评分"><a href="#评分" class="headerlink" title="评分"></a>评分</h2><p>9/10.</p>
<p>内容有趣而令人感动，主题也比较深刻，感情也非常充沛，非常值得一看！</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;正文&quot;&gt;&lt;a href=&quot;#正文&quot; class=&quot;headerlink&quot; title=&quot;正文&quot;&gt;&lt;/a&gt;正文&lt;/h2&gt;&lt;p&gt;当你因为先天缺陷而导致面容与常人不同时，你是选择封闭自己还是敞开怀抱？当你的孩子你因为先天缺陷而导致面容与常人不同时，你会怎样对待他？当你拥
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="爱" scheme="https://blog.patrickcty.cc/tags/%E7%88%B1/"/>
    
      <category term="友情" scheme="https://blog.patrickcty.cc/tags/%E5%8F%8B%E6%83%85/"/>
    
      <category term="励志" scheme="https://blog.patrickcty.cc/tags/%E5%8A%B1%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>《神秘巨星》</title>
    <link href="https://blog.patrickcty.cc/2018/01/31/%E3%80%8A%E7%A5%9E%E7%A7%98%E5%B7%A8%E6%98%9F%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2018/01/31/《神秘巨星》/</id>
    <published>2018-01-31T02:38:44.000Z</published>
    <updated>2018-01-31T02:42:48.478Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>这是阿米尔汗的另一部新作，也正是冲着阿米尔汗这个名字，我果断地贡献了一份电影票。而看完这部电影之后我感觉它确实没有让我失望。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>阿米尔汗的每部电影都反映着一个或多个印度中存在的不好的社会现象，而这次他对准的是印度的重女轻男的思想以及婚姻不平等，而这样的主题是通过小女孩对梦想的追求来表现的。</p>
<p>影片中最大的冲突就是小女孩对梦的追求与父亲不允许的冲突，影片中的父亲是一个大男子主义严重到不允许其他女人有违逆他的想法，如果有就施以暴力。而最可怕的是，这个父亲还是家庭里面的经济支柱，而毫无经济实力的母子只能逆来顺受。</p>
<p>影片中对家庭暴力的刻画还是非常到位的，甚至都让我感觉不寒而栗。也正是在家庭暴力与对梦想的阻挠两方面的共同作用下，促使了小女孩的觉醒，而另一个关键则是母亲的觉醒，但母亲则需要考虑更多实际的问题，因而对小女孩提出的离婚的要求她并没有一开始就答应，而是在将要离开印度之时才做出选择。</p>
<p>影片中最剧烈的两个冲突也即为母子觉醒的导火线，第一个是在父亲发现母亲项链消失的真相之后砸掉电脑以及最后在机场想要丢掉吉他，其中后者也是全剧中的最高潮，母亲也终于甩掉来了一直以来的懦弱以及物质的包袱而去拥抱一个未知但是有着无穷潜力的未来。</p>
<p>片中让我比较印象深刻的另一个角色就是钦腾了，这个小男孩实力告诉了我们撩妹的精髓所在，即使被嫌弃他也不放弃而是依然如故，最终他们终于修成正果（虽然我觉得有些勉强）。无论如何钦腾的性格真的是非常适合追妹子，比我好多了 233，要是我有他的一半那我一定能追到妹子 233。</p>
<p>影片中刻画得最好的是母亲这一形象，她全心全意地爱着自己的两个孩子，对女儿的爱表现得尤为明显。她非常爱女儿，对女儿的要求是有求必应，但这些仍被限制在了父亲允许的前提下，而也正是在这样的条件下，面对女儿让她离婚的请求，她才不去答应，因为这样的未来是没有物质的保障的，这样可能使女儿过得更差，因而她宁可忍受家暴也要让女儿有一个有保障的生活，因而当女儿的吉他弦被剪断她也忍了，因而当女儿的电脑被砸她也没有选择离婚。而当将离开印度之时，当她从电视和路人口中真正感受到女儿的音乐天赋时，这时候当父亲要扔掉那个被称作是“垃圾”的吉他，要彻底断绝女儿的音乐梦想，母亲终于抛弃了之前的想法与顾虑，在大众的“保护”下勇敢站了出来，选择了离开，她完成了觉醒，也选择了一条可能会艰难但是却有可能无比辉煌的道路。</p>
<p>而我们的阿米尔汗在这部电影中只是一个配角，影片中对他的描写是先抑后扬，就是这样的一个刻薄、自大、花心、惹人讨厌的人，却帮助小女孩一步一步完成了救赎，也找到了自己的初心。这个角色整体刻画得还不错，只是有些地方让人感觉用力过猛。</p>
<p>整部电影的硬伤还是不少的，但这位并不妨碍它想要表达的追求梦想、鼓励家庭暴力的受害者拿起法律的武器来反抗、追求男女平等的思想。</p>
<h2 id="评分"><a href="#评分" class="headerlink" title="评分"></a>评分</h2><p>8/10.</p>
<p>整体观影体验还不错，就是一些硬伤使得这部电影的剧本方面还有进步的空间。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;开始之前&quot;&gt;&lt;a href=&quot;#开始之前&quot; class=&quot;headerlink&quot; title=&quot;开始之前&quot;&gt;&lt;/a&gt;开始之前&lt;/h2&gt;&lt;p&gt;这是阿米尔汗的另一部新作，也正是冲着阿米尔汗这个名字，我果断地贡献了一份电影票。而看完这部电影之后我感觉它确实没有让我失望。
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="梦想" scheme="https://blog.patrickcty.cc/tags/%E6%A2%A6%E6%83%B3/"/>
    
      <category term="反对家庭暴力" scheme="https://blog.patrickcty.cc/tags/%E5%8F%8D%E5%AF%B9%E5%AE%B6%E5%BA%AD%E6%9A%B4%E5%8A%9B/"/>
    
      <category term="男女平等" scheme="https://blog.patrickcty.cc/tags/%E7%94%B7%E5%A5%B3%E5%B9%B3%E7%AD%89/"/>
    
  </entry>
  
  <entry>
    <title>《寻梦环游记》</title>
    <link href="https://blog.patrickcty.cc/2018/01/18/%E3%80%8A%E5%AF%BB%E6%A2%A6%E7%8E%AF%E6%B8%B8%E8%AE%B0%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2018/01/18/《寻梦环游记》/</id>
    <published>2018-01-18T11:32:51.000Z</published>
    <updated>2018-01-18T11:36:20.237Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>这部电影上映的时候还是在 2017.11.24，那时候因为种种原因我想看但是一直没有去看。现在我终于考完了，于是赶紧趁还没下线去电影院观看了~</p>
<p>看这部电影的时候中途放映机还坏了一会 233，不过即使没有画面，听着英文还是听得懂的 233。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>为什么想看这部电影呢？很大程度上在于我之前看的影评，那么这部电影究竟有没有影评中所说的那么好呢？下面会给出答案。</p>
<p>迪士尼和皮克斯的动画电影从来没有让人失望过，这次也是一样，无论是从主题上，画面上还是剧情上都依旧让人赞叹不已。</p>
<p>剧情中最大的冲突在于我们的主人公米格的音乐梦。米格的曾曾祖父因为去搞音乐了而离家而去再也没有回来，而这个家被曾曾祖母依靠做鞋子而一手支撑起来了，但同时曾曾祖母也认为音乐是一个诅咒，不允许家族中再出现音乐相关的内容。正因为此，家族的约束和小男孩的音乐梦发生了激烈的冲突。</p>
<p>让人眼前一亮的是，上面的这些剧情介绍是用一种特别的方式表达出来的——剪纸风格，这样的风格完美地符合了亡灵节的主题，同时又不落俗套。</p>
<p>故事的第一阶段是少年的觉醒阶段，从完全被家里人所控制无从实现自己的音乐，到萌生反抗的想法再到受到鼓舞决定不顾家人的反对勇敢去实现梦想。也正是因为有了这样的转变，少年才能无意中接触到亡灵世界。</p>
<p>而亡灵世界无疑是“炫技”的极限了，恢弘的亡灵国度通过高超的动画技术被表现得淋漓尽致。</p>
<p>第二个阶段则是米格寻找歌神。米格之所以进入亡灵世界是因为受到了诅咒，必须要得到亲人的祝福才能回到原本世界，而亲人们却同样反对他的音乐梦想，因而米格要想坚持音乐梦想则需要得到歌神，也就是他认为的曾曾祖父的帮助。</p>
<p>在剧情方面，电影故意让观众以为歌神才是米格真正的曾曾祖父，但之后却来了个大反转——原来米格真正的曾祖父并不是歌神，而是那个过不了关无法看望亲人的埃克托，歌神也没有他向外界表现得那么美好，他的成功原来建立在谋杀并且占有埃克托的成果的基础上。</p>
<p>在寻找歌神的这个过程中，米格终于展现出了自己的音乐才华，也完成了蜕变——变得自信而坚定，也从埃克托那里找到了亲情的真谛。其实关于歌神真正的面目影片中已经有铺垫：歌神的演唱会他自己却不去参加排练，而是交给其他的人员来进行，而一个稍微敬业一点的明星都不会做出这么不负责的举动。</p>
<p>第三个阶段则是回到家人的身边。埃克托的真实身份米格已经了解，但是他却一直没有被她老婆所原谅，而在这个阶段中那股仇恨终于被爱所消解，歌神的真实面目也展现在了大众面前，但这时埃克托却因为快被遗忘而即将消失，米格也在日出之前勉强回到了原本世界。</p>
<p>这部分的“战斗”部分让人印象深刻，影片充分利用了骨头的特点，将手臂拆下来当做双节棍等来使用这些非常“骨头”的场景真的非常符合世界的设定，也让人会心一笑。</p>
<p>最后一个阶段是音乐唤醒亲情。在埃克托即将被遗忘之际，米格使用埃克托的吉他，用那首写给 Coco 的《Remember Me》，成功将 Coco 的记忆唤醒，同时也消解了家庭中对音乐的误解。</p>
<p>最后的结局还是非常圆满的，歌神的真实身份，埃克托的故事也为大家所知晓，米格的音乐梦想也得以继续，Coco 也终于和埃克托团聚。</p>
<p>何为亲情？亲情应该是相互扶持的同时又相互谅解，尊重梦想，尊重家庭成员的感受这才是真正的亲情所拥有的样子。尽管伊梅尔达一开始对埃克托非常恨，恨他理开这个家不再回来，但是尽管如此，深埋着的爱并没有随之消散，而是等待着爆发的那一刻，影片想表达的亲情从这里也表现得淋漓尽致。</p>
<p>现在回到开始的那个问题：这部电影究竟有没有影评中所说的那么好呢？其实比起来还差了一点点，因为亲情这个主题实在是有些老套，但是它仍然是一部质量极佳的作品，绝对值回票价。</p>
<h2 id="评分"><a href="#评分" class="headerlink" title="评分"></a>评分</h2><p>9/10.</p>
<p>影片整体质量很高，不过比起之前的《头脑总动员》的精妙的设定还稍微差了一点，但无论如何仍然是一部无可挑剔的高质量影片。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;开始之前&quot;&gt;&lt;a href=&quot;#开始之前&quot; class=&quot;headerlink&quot; title=&quot;开始之前&quot;&gt;&lt;/a&gt;开始之前&lt;/h2&gt;&lt;p&gt;这部电影上映的时候还是在 2017.11.24，那时候因为种种原因我想看但是一直没有去看。现在我终于考完了，于是赶紧趁还没下
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="亲情" scheme="https://blog.patrickcty.cc/tags/%E4%BA%B2%E6%83%85/"/>
    
      <category term="梦想" scheme="https://blog.patrickcty.cc/tags/%E6%A2%A6%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>《敦刻尔克》</title>
    <link href="https://blog.patrickcty.cc/2018/01/13/%E3%80%8A%E6%95%A6%E5%88%BB%E5%B0%94%E5%85%8B%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2018/01/13/《敦刻尔克》/</id>
    <published>2018-01-13T02:41:36.000Z</published>
    <updated>2018-01-13T02:46:09.604Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>上次看完电影写感受还是 8.26 的《十万个冷笑话 2》了。不知不觉中，坚持了那么久的习惯就突然被终止了，就像我在另外方面的坚持，也是戛然而止。</p>
<p>现在又是考试周期间，但是如今我却不向大一的时候那么从容，曾经的“大靠大玩，小考小玩”对现在的我已然成为了过去完成时，以前的“考试电影周”亦是不复存在。</p>
<p>这学期的我的心态经历了过山车，从充满动力及幸福，到煎熬，到后来的一直的隐性自暴自弃，消极，以及现在都持续影响着我的浮躁……</p>
<p>无论如何，电影感想又开始了，闲话少叙，进入正题。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>这是诺兰继《星际穿越》之后的又一部执导作品。诺兰可以说是我最喜欢的导演了，他的作品独特的风格使得每篇作品都有一种和普通影片截然不同的观影感受，这也是我最欣赏的地方。</p>
<p>而这部《敦刻尔克》，描写的是战争，虽然不能发挥出之前的悬疑感，但是诺兰的风格还是让这部影片独具特色。</p>
<p>影片拥有三条主线，分别为空海陆，对应的是一小时，一天，十天。比较遗憾的是在看电影的地方我并没有注意到这个时间的关系，因而诺兰精密的安排我没有完全把握住。不过最后三条主线交汇到一条还是让我把握到了命运的气息。</p>
<p>我觉得这部电影想描述的最重要的不是战争，而是人。从电影刚开始的时候主角的丢枪逃跑，到之后为了生存的各种努力，都让我们感受到了战争的残酷，生存的艰难，以及战场上人的实际身理与心理状况。</p>
<p>而海上这条线则表示得更加淋漓尽致：为了向证明自己价值的乔治，因为炮弹而极度害怕的士兵，因为乔治受伤而从愤怒到最后转为体谅的彼得，从始至终都沉稳的道森先生。尽管失去了乔治，但他们所在的这艘小船将许许多多的被困在敦刻尔克的士兵带回了家，也让他们不再重蹈道森先生儿子的覆辙了。</p>
<p>而空中的这条线却更加含蓄，片尾法里亚选择不去跳伞而被俘虏这个表现得最为淋漓尽致。在击落这么多架敌机之后，法里亚面对油已经耗尽的飞机，没有选择跳伞而是随着飞机一起滑翔直到降落，是为了不让这架英国最新研制的喷火战机被德国人所得到而研究，也是为了给正在撤退的士兵带来希望，将他们从压抑中给解救出来。</p>
<p>除开人物之外，本片的配乐也是一大亮点，我是在寝室用头戴耳机来听的，配合着电影压抑的氛围，配乐更进一步渲染了这种气氛，因此整部影片看完我整个人是极度疲惫的，这种疲惫是精神上的，也间接让我感受了历史上真是存在的压抑的微小的一部分。</p>
<h2 id="评分"><a href="#评分" class="headerlink" title="评分"></a>评分</h2><p>8/10。</p>
<p>这依然是一部典型的诺兰式电影，虽然情节不及之前来得酣畅淋漓，但是看完之后还是让人感触良多，依然保持了一贯的高质量。</p>
<p>电影中生存是一件如此困难的事情，而我们呢，或许真的是只有当将要失去的时候才能感受到宝贵的地方吧。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;开始之前&quot;&gt;&lt;a href=&quot;#开始之前&quot; class=&quot;headerlink&quot; title=&quot;开始之前&quot;&gt;&lt;/a&gt;开始之前&lt;/h2&gt;&lt;p&gt;上次看完电影写感受还是 8.26 的《十万个冷笑话 2》了。不知不觉中，坚持了那么久的习惯就突然被终止了，就像我在另外方面的
    
    </summary>
    
      <category term="电影" scheme="https://blog.patrickcty.cc/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="战争" scheme="https://blog.patrickcty.cc/tags/%E6%88%98%E4%BA%89/"/>
    
      <category term="历史" scheme="https://blog.patrickcty.cc/tags/%E5%8E%86%E5%8F%B2/"/>
    
  </entry>
  
  <entry>
    <title>Java Spring Boot 笔记</title>
    <link href="https://blog.patrickcty.cc/2018/01/03/JavaSpringBoot%E7%AC%94%E8%AE%B0/"/>
    <id>https://blog.patrickcty.cc/2018/01/03/JavaSpringBoot笔记/</id>
    <published>2018-01-03T08:51:26.000Z</published>
    <updated>2018-01-03T08:52:31.504Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Collection、Map、Set-与-List"><a href="#Collection、Map、Set-与-List" class="headerlink" title="Collection、Map、Set 与 List"></a>Collection、Map、Set 与 List</h2><ul>
<li>Collection（容器）是集合接口，保存一组对象（Object）</li>
<li>Map 类似于 Python 的 dict，用来保存映射，HashMap 是 Map 的一种实现</li>
<li>List 类似于 Python 数组，用下标来取值，LinkedList、Vector 都是其实现</li>
<li>Set 是集合，只能通过游标来取值，HashMap 是其的一种实现</li>
</ul>
<h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>平常的对象和函数都是接受固定类型的变量作为参数，但是泛型接受的参数可以是不确定的，可以接受任意数据类型的变量作为参数，当然除了基本类型</p>
<h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><p>Optional 对象相当于是一个容器，它的值可以为 null。如果值存在则 isPresent() 方法会返回 true，此时调用 get() 方法就会返回容器中的对象。</p>
<p>这个类的主要作用就是把 null 用容器装起来了，可以不用显示地进行控制检测，可以有效解决空指针异常。</p>
<h2 id="jsonignore"><a href="#jsonignore" class="headerlink" title="@jsonignore"></a>@jsonignore</h2><p>在 JSON 返回的时候，有些值我们不想让它显示给客户端，比如密码，因此可以用这个注释来忽视掉这些属性</p>
<h2 id="JavaBeans"><a href="#JavaBeans" class="headerlink" title="JavaBeans"></a>JavaBeans</h2><p>JavaBeans 是 Java 中一种特殊的类，其中：</p>
<ul>
<li>所有属性为private</li>
<li>提供默认构造方法</li>
<li>提供getter和setter</li>
<li>实现serializable接口</li>
</ul>
<p>这样做是因为 Java 语言欠缺属性、事件、多重继承功能。</p>
<h2 id="gt-表达式"><a href="#gt-表达式" class="headerlink" title="-&gt; 表达式"></a>-&gt; 表达式</h2><p>和 JS 类似，Java 的 -&gt; 表达式定义的也是一个匿名函数，在这里叫做 Lambda 表达式，格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(parameters) -&gt; expression</div><div class="line">或</div><div class="line">(parameters) -&gt;&#123; statements; &#125;</div></pre></td></tr></table></figure>
<p>表达式的特点为：</p>
<ul>
<li>可选类型声明：不需要声明参数类型，编译器可以统一识别参数值。</li>
<li>可选的参数圆括号：一个参数无需定义圆括号，但多个参数需要定义圆括号。</li>
<li>可选的大括号：如果主体包含了一个语句，就不需要使用大括号。</li>
<li>可选的返回关键字：如果主体只有一个表达式返回值则编译器会自动返回值，大括号需要指定明表达式返回了一个数值。</li>
</ul>
<h2 id="Arrays-asList"><a href="#Arrays-asList" class="headerlink" title="Arrays.asList()"></a>Arrays.asList()</h2><p>这个方法是用来把参数包装成一个 List，可以接受数组作为参数。</p>
<h2 id="Spring-Boot-关键构件"><a href="#Spring-Boot-关键构件" class="headerlink" title="Spring Boot 关键构件"></a>Spring Boot 关键构件</h2><h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><p>类似于 Flask 中的 Model 类，用来表示数据库的结构。</p>
<h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h3><p>直接与数据库进行交互，类似于 Flask 中的 db.session 需要自己定义相应的方法来实现一些对数据库的 CURD 操作。</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>相当于 Flask 中的 view，表示业务逻辑的代码</p>
<h2 id="SQL-Dialect"><a href="#SQL-Dialect" class="headerlink" title="SQL Dialect"></a>SQL Dialect</h2><p>不同的 SQL 数据库都有不同的 SQL 扩展，这种扩展就是“方言”</p>
<h2 id="SQL-Server-中文显示为问号"><a href="#SQL-Server-中文显示为问号" class="headerlink" title="SQL Server 中文显示为问号"></a>SQL Server 中文显示为问号</h2><p>这个是字符集(collate)顺序的锅，默认的字符集不显示中文，我使用了下面的语句来更改数据库的字符集顺序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter database dbname collate Chinese_PRC_CI_AS</div></pre></td></tr></table></figure>
<p>以及下面的语句更改表中列的字符集：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table tbname alter column clname cltype collate Chinese_PRC_CI_AS</div></pre></td></tr></table></figure>
<p>结果改了之后查询以及插入值再查询后依然是问号，但是重新创建数据库之后就可以正确显示中文了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create database dbname collate chinese_prc_ci_as</div></pre></td></tr></table></figure>
<p>真的好坑，不知道是不是我人品比较差不能直接修改。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://zhidao.baidu.com/question/51161338.html" target="_blank" rel="external">https://zhidao.baidu.com/question/51161338.html</a></li>
<li><a href="https://stackoverflow.com/questions/16685269/error-on-renaming-database-in-sql-server-2008-r2" target="_blank" rel="external">https://stackoverflow.com/questions/16685269/error-on-renaming-database-in-sql-server-2008-r2</a></li>
</ul>
<h2 id="List-用法"><a href="#List-用法" class="headerlink" title="List 用法"></a>List 用法</h2><h3 id="取出-List-中的元素"><a href="#取出-List-中的元素" class="headerlink" title="取出 List 中的元素"></a>取出 List 中的元素</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list.get(1)  // 数字为 index</div></pre></td></tr></table></figure>
<h3 id="检查-List-是否为空"><a href="#检查-List-是否为空" class="headerlink" title="检查 List 是否为空"></a>检查 List 是否为空</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list.isEmpty()</div></pre></td></tr></table></figure>
<h3 id="查看-List-的大小"><a href="#查看-List-的大小" class="headerlink" title="查看 List 的大小"></a>查看 List 的大小</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list.size()</div></pre></td></tr></table></figure>
<h2 id="JPA-中的查询方法"><a href="#JPA-中的查询方法" class="headerlink" title="JPA 中的查询方法"></a>JPA 中的查询方法</h2><p>和 SQLAlchemy 类似，除非指定返回一个结果，JPA 中返回的结果也是按照集合来表示的，因此也要用 List 等来保存结果。</p>
<p>如果指定了 <code>findFirstByXXX</code> 或者 <code>findOneByXXX</code> 就可以只返回一个结果。</p>
<h2 id="RequestBody-的用法"><a href="#RequestBody-的用法" class="headerlink" title="@RequestBody 的用法"></a>@RequestBody 的用法</h2><p>在 REST 应用中，我们一般接受 JSON 作为传入的参数，使用 @RequestBody 之后就只能接受 JSON 作为参数了，不能接受 form-data 等，而此时的 Content-Type 要为 application/json</p>
<p>这个地方和 Python 的还不一样，Flask-RestFul 不仅仅可以接受 JSON 作为参数，还可以解析出很多其他种类的数据。</p>
<p>如果直接使用相应的 Entity 作为参数，那这样的参数就只能识别 form-data，而其他的都不能识别了。</p>
<p>参考教程：<a href="http://blog.csdn.net/rickyit/article/details/70242218" target="_blank" rel="external">http://blog.csdn.net/rickyit/article/details/70242218</a></p>
<h2 id="JPA-使用-DateTime-与-数据库相联系"><a href="#JPA-使用-DateTime-与-数据库相联系" class="headerlink" title="JPA 使用 DateTime 与 数据库相联系"></a>JPA 使用 DateTime 与 数据库相联系</h2><p>在 Java 中直接使用 Date 来新建一个实时间的变量，然后在数据库里面对应的就是 DateTime 类型的了。</p>
<p>其中数据库时间戳类型要根据 @Temporal 注解来指定，相应代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@Column(name=&quot;DATE_CREATED&quot;)</div><div class="line">@Temporal(TemporalType.TIMESTAMP)</div><div class="line">private java.util.Date dateCreated;</div></pre></td></tr></table></figure>
<p>参考教程：<a href="https://stackoverflow.com/questions/9409342/handle-datetime-in-jpa2" target="_blank" rel="external">https://stackoverflow.com/questions/9409342/handle-datetime-in-jpa2</a></p>
<h2 id="JPA-中的一对多关系"><a href="#JPA-中的一对多关系" class="headerlink" title="JPA 中的一对多关系"></a>JPA 中的一对多关系</h2><p>使用 @OneToMany 以及 @ManyToOne 注解来定义，详细教程看<a href="http://www.cnblogs.com/luxh/archive/2012/05/27/2520322.html" target="_blank" rel="external">这个</a>和<a href="http://www.cnblogs.com/luxh/archive/2012/05/27/2520501.html" target="_blank" rel="external">这个</a>，其中双向映射是可以从任意一个对象引用另一个对象，而单向则是只有一边才可以</p>
<h2 id="JPA-设置默认时间"><a href="#JPA-设置默认时间" class="headerlink" title="JPA 设置默认时间"></a>JPA 设置默认时间</h2><p>每次插入数据时候生成的时间用 @CreationTimestamp 来表示，每次更新数据生成的时间用 @UpdateTimestamp 来表示</p>
<p>参考教程：<a href="http://blog.csdn.net/sushengmiyan/article/details/50360451" target="_blank" rel="external">http://blog.csdn.net/sushengmiyan/article/details/50360451</a></p>
<h2 id="fastjson-使用"><a href="#fastjson-使用" class="headerlink" title="fastjson 使用"></a>fastjson 使用</h2><p>fastjson 是阿里所编写的 Java 处理 JSON 的模块，据说有超高的速度。</p>
<p>Maven 依赖：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.2.41&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>把 JSON 字符串解析为 JSON 对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">JSONObject jsonResult = JSONObject.parseObject(strResult);</div></pre></td></tr></table></figure>
<p>把 JSON 字符串解析为 JSON 数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">JSONArray jsonArray = JSONObject.parseArray(strResult)</div></pre></td></tr></table></figure>
<p>把 Map 转换为 JSON 字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Map param&lt;String, Object&gt; = ...;</div><div class="line">String JSONString = JSON.toJSONString(param);</div></pre></td></tr></table></figure>
<h2 id="HTTPClient-发送-HTTP-请求"><a href="#HTTPClient-发送-HTTP-请求" class="headerlink" title="HTTPClient 发送 HTTP 请求"></a>HTTPClient 发送 HTTP 请求</h2><h3 id="Maven-依赖"><a href="#Maven-依赖" class="headerlink" title="Maven 依赖"></a>Maven 依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.5&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h3 id="Get-请求"><a href="#Get-请求" class="headerlink" title="Get 请求"></a>Get 请求</h3><p>建立 HTTP 客户端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CloseableHttpClient client = HttpClients.createDefault();</div></pre></td></tr></table></figure>
<p>建立 Get 请求:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HttpGet getRequest = new HttpGet(url);</div></pre></td></tr></table></figure>
<p>发送 Get 请求并且保存返回结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HttpResponse response = client.execute(getRequest);</div></pre></td></tr></table></figure>
<p>获取状态码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response.getStatusLine().getStatusCode()</div></pre></td></tr></table></figure>
<h3 id="Post-请求"><a href="#Post-请求" class="headerlink" title="Post 请求"></a>Post 请求</h3><p>建立客户端：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CloseableHttpClient client = HttpClients.createDefault();</div></pre></td></tr></table></figure>
<p>建立 Post 请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HttpPost postRequest = new HttpPost(url);</div></pre></td></tr></table></figure>
<p>构建 Post JSON 请求体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, Object&gt; param = new LinkedHashMap&lt;String, Object&gt;();</div><div class="line">param.put(&quot;appid&quot;, &quot;wxgegfegffe&quot;);</div></pre></td></tr></table></figure>
<p>把 Map 转换为 JSON 字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String JSONString = JSON.toJSONString(param);</div></pre></td></tr></table></figure>
<p>设置实体编码，防止中文乱码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">StringEntity entity = new StringEntity(JSONString, &quot;utf-8&quot;);</div></pre></td></tr></table></figure>
<p>设置 HTTP 中的编码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">entity.setContentEncoding(&quot;UTF-8&quot;);</div><div class="line">entity.setContentType(&quot;application/json&quot;);</div></pre></td></tr></table></figure>
<p>把实体包含到 Post 请求中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">postRequest.setEntity(entity);</div></pre></td></tr></table></figure>
<p>发送 HTTP 请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HttpResponse response = client.execute(postRequest);</div></pre></td></tr></table></figure></p>
<h2 id="构建-token"><a href="#构建-token" class="headerlink" title="构建 token"></a>构建 token</h2><h3 id="Maven-依赖-1"><a href="#Maven-依赖-1" class="headerlink" title="Maven 依赖"></a>Maven 依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;5.1&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<h3 id="生成-token"><a href="#生成-token" class="headerlink" title="生成 token"></a>生成 token</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">// Generate random 256-bit (32-byte) shared secret</div><div class="line">SecureRandom random = new SecureRandom();</div><div class="line">byte[] sharedSecret = new byte[32];</div><div class="line">random.nextBytes(sharedSecret);</div><div class="line"></div><div class="line">// Create HMAC signer</div><div class="line">// 需要接受一个 256-bit 的内容作为参数</div><div class="line">JWSSigner signer = new MACSigner(sharedSecret);</div><div class="line"></div><div class="line">// Prepare JWT with claims set</div><div class="line">// 也就是封装进去的一些信息</div><div class="line">JWTClaimsSet claimsSet = new JWTClaimsSet.Builder()</div><div class="line">    .subject(&quot;alice&quot;)</div><div class="line">    .issuer(&quot;https://c2id.com&quot;)</div><div class="line">    .expirationTime(new Date(new Date().getTime() + 60 * 1000))</div><div class="line">    .build();</div><div class="line"></div><div class="line">// 使用 HAMC 来保护这个 claimSet</div><div class="line">// HAMC 是 hash-based message authentication code</div><div class="line">SignedJWT signedJWT = new SignedJWT(new JWSHeader(JWSAlgorithm.HS256), claimsSet);</div><div class="line"></div><div class="line">// Apply the HMAC protection</div><div class="line">signedJWT.sign(signer);</div><div class="line"></div><div class="line">// Serialize to compact form, produces something like</div><div class="line">// eyJhbGciOiJIUzI1NiJ9.SGVsbG8sIHdvcmxkIQ.onO9Ihudz3WkiauDO2Uhyuz0Y18UASXlSc1eS0NkWyA</div><div class="line">// 这就是生成的 token</div><div class="line">String token = signedJWT.serialize();</div></pre></td></tr></table></figure>
<h3 id="验证-token"><a href="#验证-token" class="headerlink" title="验证 token"></a>验证 token</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// On the consumer side, parse the JWS and verify its HMAC</div><div class="line">signedJWT = SignedJWT.parse(token);</div><div class="line"></div><div class="line">// 通过这个共享密码来检测</div><div class="line">JWSVerifier verifier = new MACVerifier(sharedSecret);</div><div class="line"></div><div class="line">// assert 是 Junit 中的方法</div><div class="line">// 如果共享密码是正确的那么这个结果就为真</div><div class="line">assertTrue(signedJWT.verify(verifier));</div><div class="line"></div><div class="line">// Retrieve / verify the JWT claims according to the app requirements</div><div class="line">// 和 Python 相应的模块不同，这里要手动进行相应的检验</div><div class="line">assertEquals(&quot;alice&quot;, signedJWT.getJWTClaimsSet().getSubject());</div><div class="line">assertEquals(&quot;https://c2id.com&quot;, signedJWT.getJWTClaimsSet().getIssuer());</div><div class="line">assertTrue(new Date().before(signedJWT.getJWTClaimsSet().getExpirationTime()));</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Collection、Map、Set-与-List&quot;&gt;&lt;a href=&quot;#Collection、Map、Set-与-List&quot; class=&quot;headerlink&quot; title=&quot;Collection、Map、Set 与 List&quot;&gt;&lt;/a&gt;Collection、
    
    </summary>
    
      <category term="Web" scheme="https://blog.patrickcty.cc/categories/Web/"/>
    
    
      <category term="Java" scheme="https://blog.patrickcty.cc/tags/Java/"/>
    
      <category term="Spring Boot" scheme="https://blog.patrickcty.cc/tags/Spring-Boot/"/>
    
      <category term="Hibernate" scheme="https://blog.patrickcty.cc/tags/Hibernate/"/>
    
      <category term="REST" scheme="https://blog.patrickcty.cc/tags/REST/"/>
    
      <category term="Web" scheme="https://blog.patrickcty.cc/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>GoNetwork 学习</title>
    <link href="https://blog.patrickcty.cc/2018/01/03/GoNetwork%E5%AD%A6%E4%B9%A0/"/>
    <id>https://blog.patrickcty.cc/2018/01/03/GoNetwork学习/</id>
    <published>2018-01-03T08:50:37.000Z</published>
    <updated>2018-01-03T08:51:00.746Z</updated>
    
    <content type="html"><![CDATA[<h2 id="off-chain-state-channel-与闪电网络"><a href="#off-chain-state-channel-与闪电网络" class="headerlink" title="off-chain state channel 与闪电网络"></a>off-chain state channel 与闪电网络</h2><p>off-chain state channel 是一种区块链上的解决方案，目的是为了解决区块链的扩展性、高延迟。交易费用问题，它通过在用户之间建立通道进行多次交易，最终的结果再放到链上。</p>
<p>雷电（Radien）网络和闪电（lightening）网络都是状态通道的实现方法，不过前者是基于以太坊，后者是基于比特币。</p>
<p>在状态通道中转移的相当于是支票，如果要兑换支票的话还是要去银行（区块链），但是兑换的时候状态通道就会关闭，而理论上状态通道开得越久越好。创建状态通道需要先在主链上初始化一个固定的金额，之后就是通道中对这个金额的分配了。</p>
<p>生命周期：</p>
<ol>
<li>由两个或两个以上的参与者公开的对初始状态达成一致，即一个状态通道开启。（在一笔交易中，涉及到的资金将交给交给第三方委托或者智能合约去临时封存），比如去银行开卡，你是用户，银行是服务，双方确认初始金额是0元无异议后，就开启一个通道。</li>
<li>参与方之间可以更新最近的每笔交易状态，状态本身存储在本地。</li>
<li>当参与方的任何一方将交易状态最终公布，则状态通道关闭。</li>
</ol>
<p>参考资料：</p>
<ul>
<li><a href="http://gocofe.com/2017/06/%E8%B0%88%E8%B0%88%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E7%9A%84%E7%8A%B6%E6%80%81%E9%80%9A%E9%81%93%EF%BC%88state-channels%EF%BC%89/" target="_blank" rel="external">http://gocofe.com/2017/06/%E8%B0%88%E8%B0%88%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E7%9A%84%E7%8A%B6%E6%80%81%E9%80%9A%E9%81%93%EF%BC%88state-channels%EF%BC%89/</a></li>
<li><a href="http://ethfans.org/posts/raiden-network" target="_blank" rel="external">http://ethfans.org/posts/raiden-network</a></li>
<li><a href="https://raiden.network/faq.html" target="_blank" rel="external">https://raiden.network/faq.html</a></li>
<li><a href="http://www.8btc.com/ln-rn-corda" target="_blank" rel="external">http://www.8btc.com/ln-rn-corda</a></li>
</ul>
<h2 id="GoNetwork-白皮书"><a href="#GoNetwork-白皮书" class="headerlink" title="GoNetwork 白皮书"></a>GoNetwork 白皮书</h2><p>白皮书主要讲述了是其应用与商业计划，其中是基于 state channel 来实现的 scalability，mobile 部分体现在他们部署他们的解决方案到移动的游戏应用中（作为一种支付方式）</p>
<p>自己的思考：</p>
<p>GoNetwork 和雷电网络与闪电网络类似，都是基于状态通道，这的确是一种不用改变区块链本身存储结构而提高区块链扩展性的好方法，同时也加快了处理的速度，而安全性也能通过签名来实现；而把产品与游戏进行结合也是一种好的推广方法，依赖于移动端也在无形中降低了用户门槛。</p>
<p>不过因为状态通道的建立还是需要在主链上添加 TX，因此当真的突然产生了大量的通道可能还是会造成整个网络的拥堵，不过如果这种情况出现的概率不高的话那么不处理也不会有太大的影响。</p>
<h2 id="论文"><a href="#论文" class="headerlink" title="论文"></a>论文</h2><h3 id="The-Quest-for-Scalable-Blockchain-Fabric-Proof-of-Work-vs-BFT-Replication"><a href="#The-Quest-for-Scalable-Blockchain-Fabric-Proof-of-Work-vs-BFT-Replication" class="headerlink" title="The Quest for Scalable Blockchain Fabric: Proof-of-Work vs. BFT Replication"></a>The Quest for Scalable Blockchain Fabric: Proof-of-Work vs. BFT Replication</h3><ol>
<li>the GHOST (Greedy Heaviest-Observed Sub-Tree) rule：产生了 fork 之后通过权衡子树来解决，而不是选择最长的区块。<br>这个方法通过提高区块链性能来增加可扩展性但不影响存储</li>
<li>BlockChain-NG：挖出矿的成为 leader，leader 可以添加 microblock（通过时间戳来判断有效性）到链上，这些链不受 PoW 挖掘的限制，而只是被拼凑在一起。<br>microblock 提高了吞吐量并且降低了延迟，也同样不减少存储</li>
<li>加上支链成为有向无环图<br>这个方法提高了并性能力从而提高了处理速度，同样不减少存储</li>
</ol>
<h3 id="Bitcoin-NG-A-Scalable-Blockchain-Protocol"><a href="#Bitcoin-NG-A-Scalable-Blockchain-Protocol" class="headerlink" title="Bitcoin-NG: A Scalable Blockchain Protocol"></a>Bitcoin-NG: A Scalable Blockchain Protocol</h3><p>即为上面所提到的</p>
<h3 id="The-Bitcoin-Lightning-Network-Scalable-Off-Chain-Instant-Payments"><a href="#The-Bitcoin-Lightning-Network-Scalable-Off-Chain-Instant-Payments" class="headerlink" title="The Bitcoin Lightning Network: Scalable Off-Chain Instant Payments"></a>The Bitcoin Lightning Network: Scalable Off-Chain Instant Payments</h3><p>比特币的闪电网络，使用了状态通道来提高可扩展性，这个方法也减小了区块链上的存储</p>
<h3 id="On-Scaling-Decentralized-Blockchains"><a href="#On-Scaling-Decentralized-Blockchains" class="headerlink" title="On Scaling Decentralized Blockchains"></a>On Scaling Decentralized Blockchains</h3><p>块大小和时间间隔的重新参数化来解决可扩展性问题，这个方法不影响存储</p>
<h3 id="Notes-on-Scalable-Blockchain-Protocols"><a href="#Notes-on-Scalable-Blockchain-Protocols" class="headerlink" title="Notes on Scalable Blockchain Protocols"></a>Notes on Scalable Blockchain Protocols</h3><p>通过“采样和回退”游戏实现可伸缩的区块链共识：将交易拆分成影响区块链状态的小部分的 collations，并要求为了使交易的 collation 有效，必须通过从大型验证池随机获取的固定大小的样本的验证。</p>
<p>这个方法不影响存储，但是提高了速度和可扩展性</p>
<h3 id="When-Mobile-Blockchain-Meets-Edge-Computing-Challenges-and-Applications"><a href="#When-Mobile-Blockchain-Meets-Edge-Computing-Challenges-and-Applications" class="headerlink" title="When Mobile Blockchain Meets Edge Computing: Challenges and Applications"></a>When Mobile Blockchain Meets Edge Computing: Challenges and Applications</h3><p>通过使用边缘计算来将区块链运用于移动端，没有提高区块链的可扩展性也没有减少存储</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;off-chain-state-channel-与闪电网络&quot;&gt;&lt;a href=&quot;#off-chain-state-channel-与闪电网络&quot; class=&quot;headerlink&quot; title=&quot;off-chain state channel 与闪电网络&quot;&gt;&lt;/a
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>使用 Java 连接 SQL Server</title>
    <link href="https://blog.patrickcty.cc/2018/01/03/%E4%BD%BF%E7%94%A8Java%E8%BF%9E%E6%8E%A5SQLServer/"/>
    <id>https://blog.patrickcty.cc/2018/01/03/使用Java连接SQLServer/</id>
    <published>2018-01-03T08:48:37.000Z</published>
    <updated>2018-01-03T08:49:39.007Z</updated>
    
    <content type="html"><![CDATA[<h2 id="下载配置-JDBC-驱动"><a href="#下载配置-JDBC-驱动" class="headerlink" title="下载配置 JDBC 驱动"></a>下载配置 JDBC 驱动</h2><p>在 MS 官网下载 JDBC 驱动，链接<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=21599" target="_blank" rel="external">点这里</a>。</p>
<p>Windows 版下载 exe 包，运行完成解压。然后把 Microsoft SQL Server JDBC Driver 3.0\sqljdbc_3.0\chs\auth\x64\sqljdbc_auth.dll文件 复制到C:\Windows\SysWOW64目录下。（64bit系统）</p>
<p>将 Microsoft SQL Server JDBC Driver 3.0\sqljdbc_3.0\chs\sqljdbc4.jar 包导入到项目中。我是使用 IntelliJ，参考<a href="http://zyjustin9.iteye.com/blog/2172445" target="_blank" rel="external">这个教程</a>。</p>
<h2 id="使用-Java-连接"><a href="#使用-Java-连接" class="headerlink" title="使用 Java 连接"></a>使用 Java 连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line">import java.sql.*;</div><div class="line"></div><div class="line">public class Main &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Connection conn = null;  // 存储连接</div><div class="line">        Statement stmt = null;  // SQL 语句相关</div><div class="line">        ResultSet rs = null;  // 执行结果，只有查询语句才有结果</div><div class="line">        // 数据库 url，用来连接 SQL Server</div><div class="line">        // 注意这里不能使用 Windows 验证，因此要自己创建 login</div><div class="line">        String url = &quot;jdbc:sqlserver://localhost:1433;&quot; +</div><div class="line">                &quot;databaseName=学生-课程;user=patrickcty;password=patrickcty&quot;;</div><div class="line">        try &#123;</div><div class="line">            // 导入驱动</div><div class="line">            Class.forName(&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;);</div><div class="line">            conn = DriverManager.getConnection(url);  // 建立连接</div><div class="line"></div><div class="line">            // 连接检测</div><div class="line">            if (conn != null) &#123;</div><div class="line">                System.out.println(&quot;Success connected!&quot;);</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                System.out.println(&quot;Not connected!&quot;);</div><div class="line">            &#125;</div><div class="line">            // 创建语句对象</div><div class="line">            stmt = conn.createStatement();</div><div class="line">            String sql = &quot;select * from student&quot;;</div><div class="line">            // 查询语句用这个方法</div><div class="line">            // 结果保存在 rs 中</div><div class="line">            rs = stmt.executeQuery(sql);</div><div class="line">            while (rs.next()) &#123;</div><div class="line">                System.out.println(&quot;学号：&quot; + rs.getString(1) + &quot;姓名：&quot; + rs.getString(2));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            // 插删改用这个方法</div><div class="line">            sql = &quot;insert into student values (&apos;2015000021&apos;, &apos;开普勒&apos;, &apos;男&apos;, 25, &apos;物理系&apos;)&quot;;</div><div class="line">            stmt.executeUpdate(sql);</div><div class="line"></div><div class="line">            sql = &quot;update student set sdept = &apos;文学系&apos; where sname = &apos;卡莲&apos;&quot;;</div><div class="line">            stmt.executeUpdate(sql);</div><div class="line"></div><div class="line">            sql = &quot;delete from student where sname = &apos;开普勒&apos;&quot;;</div><div class="line">            stmt.executeUpdate(sql);</div><div class="line"></div><div class="line">            sql = &quot;select * from student&quot;;</div><div class="line">            rs = stmt.executeQuery(sql);</div><div class="line">            while (rs.next()) &#123;</div><div class="line">                System.out.println(&quot;学号：&quot; + rs.getString(1) + &quot;姓名：&quot; + rs.getString(2));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            sql = &quot;create table test (id int)&quot;;</div><div class="line">            stmt.executeUpdate(sql);</div><div class="line"></div><div class="line">            sql = &quot;select * from sysobjects where xtype=&apos;U&apos;&quot;;</div><div class="line">            rs = stmt.executeQuery(sql);</div><div class="line">            while (rs.next()) &#123;</div><div class="line">                System.out.println(&quot;表名：&quot; + rs.getString(1));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            sql = &quot;drop table test&quot;;</div><div class="line">            stmt.executeUpdate(sql);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        catch (Exception ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        // 关闭各种连接</div><div class="line">        finally &#123;</div><div class="line">            try &#123;</div><div class="line">                if (rs != null) &#123;</div><div class="line">                    rs.close();</div><div class="line">                &#125;</div><div class="line">                if (stmt != null) &#123;</div><div class="line">                    stmt.close();</div><div class="line">                &#125;</div><div class="line">                if (conn != null) &#123;</div><div class="line">                    conn.close();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            catch (Exception ex) &#123;</div><div class="line">                ex.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ul>
<li><p>查询的时候报错“sqlserver 服务器主体无法在当前安全上下文下访问数据库”</p>
<blockquote>
<p>问题在于这个账号没有要查询的表的权限……想当然地一维这个账号有这个权限……</p>
</blockquote>
</li>
<li><p>打开 SQL Server Browser 遇到的各种问题</p>
<blockquote>
<p>为什么要打开 SQL Server Browser 呢？因为我已开始想用 IntelliJ 中的数据库工具来连接 SQL Server，而这个工具需要使用这个服务，但是按照<a href="https://blog.jetbrains.com/datagrip/2016/06/21/connecting-datagrip-to-ms-sql-server/" target="_blank" rel="external">教程</a>来在打开服务的时候无法执行，最后参照<a href="http://blog.csdn.net/u012586848/article/details/46860839" target="_blank" rel="external">这个教程</a>打开了这个服务。结果最后才发现已经有了 SSMS 根本没必要再多此一举做这个工作……所以头脑一定要冷静，不然很容易就做了无用功……<br>然后 SQL Server Browser 其实是用在一个物理服务器上有多个 SQL Server 实例的时候，这个服务确保客户端能访问到正确的实例。</p>
</blockquote>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://www.cnblogs.com/freeabyss/archive/2013/04/15/3187065.html" target="_blank" rel="external">http://www.cnblogs.com/freeabyss/archive/2013/04/15/3187065.html</a></li>
<li><a href="http://www.cnblogs.com/chenxizhang/archive/2009/06/30/1514202.html" target="_blank" rel="external">http://www.cnblogs.com/chenxizhang/archive/2009/06/30/1514202.html</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;下载配置-JDBC-驱动&quot;&gt;&lt;a href=&quot;#下载配置-JDBC-驱动&quot; class=&quot;headerlink&quot; title=&quot;下载配置 JDBC 驱动&quot;&gt;&lt;/a&gt;下载配置 JDBC 驱动&lt;/h2&gt;&lt;p&gt;在 MS 官网下载 JDBC 驱动，链接&lt;a href=&quot;h
    
    </summary>
    
      <category term="课程" scheme="https://blog.patrickcty.cc/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
      <category term="Java" scheme="https://blog.patrickcty.cc/tags/Java/"/>
    
      <category term="课程" scheme="https://blog.patrickcty.cc/tags/%E8%AF%BE%E7%A8%8B/"/>
    
      <category term="SQL Server" scheme="https://blog.patrickcty.cc/tags/SQL-Server/"/>
    
  </entry>
  
  <entry>
    <title>首次接触智能合约遇到的坑</title>
    <link href="https://blog.patrickcty.cc/2017/12/03/%E9%A6%96%E6%AC%A1%E6%8E%A5%E8%A7%A6%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
    <id>https://blog.patrickcty.cc/2017/12/03/首次接触智能合约遇到的坑/</id>
    <published>2017-12-03T03:26:06.000Z</published>
    <updated>2017-12-03T03:29:31.421Z</updated>
    
    <content type="html"><![CDATA[<p>在很多的教程中，都是使用如下方法来编译 sol 代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">contract = eth.compile.solidity(contractSource).test</div></pre></td></tr></table></figure>
<p>但这样会报错：</p>
<blockquote>
<p>Error: The method eth_getCompilers does not exist/is not available</p>
</blockquote>
<p>原因在于在最新的 API 中这个方法已经被抛弃了，因此我们只能手动编译代码再创建一个合约类了。</p>
<p>编译的方法可以直接用 solc 命令来编译，不过直接在 <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="external">remix</a>——可以看做一个在线的 Solidity IDE 中编译会比较方便。</p>
<p>编译之后记录下 abi 以及编译后的二进制代码，然后使用下面语句初始化智能合约类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yourContract = web3.eth.contract(your_abi)</div></pre></td></tr></table></figure>
<p>再用智能合约类来创建一个智能合约的实例并且部署到区块链上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var ss = browser_ballot_sol_smartsponsorContract.new(</div><div class="line">   _benefactor,  // 接受钱的人</div><div class="line">   &#123;</div><div class="line">     from: therunner,  // 智能合约发起者 </div><div class="line">     data: theBinaryCode</div><div class="line">     gas: &apos;4700000&apos;  // 需要的手续费</div><div class="line">   &#125;, function (e, contract)&#123;</div><div class="line">    console.log(e, contract);</div><div class="line">    if (typeof contract.address !== &apos;undefined&apos;) &#123;</div><div class="line">         console.log(&apos;Contract mined! address: &apos; + contract.address + &apos; transactionHash: &apos; + contract.transactionHash);</div><div class="line">    &#125;</div><div class="line"> &#125;)</div></pre></td></tr></table></figure>
<p>之后就只需要使用 <code>loadScript</code> 来加载出合约了。</p>
<p>注意：当合约已经被部署到区块链上就不能再修改了，如果要再次访问就要通过 abi 与 address 了，如果不记得这些的话就无法再次访问到合约了。</p>
<h2 id="无法正常连接"><a href="#无法正常连接" class="headerlink" title="无法正常连接"></a>无法正常连接</h2><p><a href="http://ethfans.org/posts/block-chain-technology-smart-contracts-and-ethereum" target="_blank" rel="external">在之前的教程</a>中我们要使用 <code>geth attach</code> 命令来连接到相应的网络中，但是直接使用这个命令的话会提示无法找到 ipc 文件。</p>
<p>报错的原因在于直接使用这条命令连接的默认的公有链，但是我们想连接的是自己定义的私有链，因此我们要用私有链接的 ipc 来进行连接。</p>
<p>首先要启动我们的私有连，在启动之后会有如下的提示信息：</p>
<blockquote>
<p>IPC endpoint opened: /Users/patrick/Music/BlockChain/data/geth.ipc<br>Welcome to the Geth JavaScript console!</p>
<p>instance: Geth/v1.7.2-stable-1db4ecdc/darwin-amd64/go1.9<br>coinbase: 0xea21220a7ab78b50107734d7a4a6ca19cc39f595<br>at block: 139 (Fri, 01 Dec 2017 23:55:34 CST)<br> datadir: /Users/patrick/Music/BlockChain/data<br> modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</p>
</blockquote>
<p>这里第一行的 ipc 就是我们所需要的私有链的地址，然后使用如下命令就可以连接上私有链了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; geth attach ipc:/the/path/of/the/ipc</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在很多的教程中，都是使用如下方法来编译 sol 代码：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;t
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>区块链技术-智能合约-以太坊（译文修改版）</title>
    <link href="https://blog.patrickcty.cc/2017/12/03/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E4%BB%A5%E5%A4%AA%E5%9D%8A%EF%BC%88%E8%AF%91%E6%96%87%E4%BF%AE%E6%94%B9%E7%89%88%EF%BC%89/"/>
    <id>https://blog.patrickcty.cc/2017/12/03/区块链技术-智能合约-以太坊（译文修改版）/</id>
    <published>2017-12-03T03:24:20.000Z</published>
    <updated>2017-12-03T03:25:16.397Z</updated>
    
    <content type="html"><![CDATA[<p>本文仅仅是出于学习的目的，对 King Wang 的译文中的代码部分根据当前版本的工具进行了更新。</p>
<hr>
<p>本文征得IBM的Glynn Bird同意翻译发表。虽然文章没有很深的理论，但是它用简洁的语言描述了区块链技术，智能合约，以及以太坊。文章用了一个可以运行的慈善募捐实例，把以太坊最核心的功能做了演示。</p>
<hr>
<p>区块链(BlockChain)技术吸引了大量的关注，原因不仅是它作为账本来纪录交易，成为加密货币(例如比特币)的引擎；更重要的是，它可以封装代码和数据，成为“智能合约”(Smart Contract)。本文介绍开源区块链技术的一种：以太坊(Ethereum), 并且以慈善募捐为例构建一个智能合约，来演示这种技术的强大之处。</p>
<h2 id="什么是区块链"><a href="#什么是区块链" class="headerlink" title="什么是区块链"></a>什么是区块链</h2><p>区块链是一种数据结构，把数据按时间顺序存储在可以无限伸长的链表中，就像一个账本。区块链数据结构通过分布式，无中心“主”节点，点对点的计算机网络来维护。链表中的每个区块包含一定数量的交易，交易代表数据库状态的改变，例如，钱从一个帐号转到另一个。交易由网络中的多个节点验证，并且最终存储在区块链的区块里面。每个区块包含一个签名哈希(Signed Hash)，包含的是链表中前一个区块的内容。遍历整个区块链可以验证：某个区块的哈希确实是存储在链表中后一个区块里。区块链用图来表示是这样子的：</p>
<p>The Genesis Block是最原始的区块。H()是哈希。Transaction是交易。Time是时间轴，从原始区块链到无限。</p>
<p><img src="http://upyun-assets.ethfans.org/uploads/photo/image/56f449a7d8e9486784757e9ddc7294d6.png" alt="区块链结构"></p>
<p>区块链包含一系列价值的转移，从一个地址转到另一个。一个地址代表系统中唯一的一个帐号。地址实际上是一个公钥，它的对应私钥属于创建账号的那个用户。没有用账户的私钥做数字签名，价值就不能从那个账户中转移。</p>
<p>在加密保护交易的同时，区块链还提供数据库状态的分布共识。它保证价值转移要么发生一次，要么不发生。应用开发人员可以放心：因为数据一旦存储，就不能修改，可以信赖。区块链网络抽取一个计算机节点，在区块链中产生下一个区块，这个节点要花费大量的算力解决一个数学任务，这个节点是事先未知的。这个节点找到了问题的解答，可以命名下一个区块并发布，网络中的其它节点验证这个发布的区块。由于证明了工作量(Proof of Work)， 赢得发布的节点得到两种奖励：获得新铸成的加密货币，以及从创建交易的一方收取费用。这个过程称为“挖矿”，它的目的是：</p>
<ol>
<li>铸成新的加密货币，而产生货币的速率是受严格控制的</li>
<li>奖励“矿工”，“矿工”验证了交易以及在网络中达成共识</li>
</ol>
<p>实践中，有非常快的特殊硬件，挖矿就有优势，所以就有了“军备竞赛”：矿工们采用越来越多的硬件，来维持同样的获取货币的速率。</p>
<p>比特币是最有名的区块链的实用例子。比特币是可以交换真实货币的加密货币。它可以通过区块链交易，在比特币账号(钱包)之间转移。本文写作时，比特币点对点网络有7000个节点。</p>
<h2 id="以太坊和智能合约"><a href="#以太坊和智能合约" class="headerlink" title="以太坊和智能合约"></a>以太坊和智能合约</h2><p>区块链吸引应用开发人员的主要的性质有：</p>
<ol>
<li>区块链由别人运营。如果你的应用把数据存在大家都用的区块链，它就不需要为数据提供存储机制。区块链中的节点提供存储有激励：收交易费和有机会铸新币。</li>
<li>区块链提供分布共识机制，你自己做很难。</li>
<li>区块链为用户提供匿名机制。一个账号身份标识(ID)是个公钥,它不一定和人直接相关。</li>
<li>“价值”可以从一个账号转移到另一个，但是费用要小于传统的真实货币转账机制。</li>
<li>如果某个区块链受信赖，那么存储在那个区块链的交易也受信赖。</li>
</ol>
<p>以太坊采用区块链的原理，又增加了在区块链上创建智能合约：智能合约是一种应用，它能保存价值，存储数据，封装代码，执行计算任务。类似比特币，以太坊也含有货币，称为以太(ether)。以太是计算机节点挖出来的，由节点验证交易，交易存储在分布共识的区块链中。以太可以在账户(公钥)之间以及智能合约之间转移。</p>
<p>智能合约允许匿名的几方进入约束协议，每个参与方对交易完全知情。价值可以在账户间转移，或者放在智能合约中的第三方托管（escrow ）。由于合约就是代码，开发者想做什么应用，就能做得出，你的想象力是唯一的限制。</p>
<h2 id="智能合约的例子：智能赞助-smartSponsor"><a href="#智能合约的例子：智能赞助-smartSponsor" class="headerlink" title="智能合约的例子：智能赞助(smartSponsor)"></a>智能合约的例子：智能赞助(smartSponsor)</h2><p>在本文的剩余部分，我们构建一个智能合约，它可以让持有账户的用户做以下互动:</p>
<ol>
<li>一个慈善机构搞募捐，称为受益者thebenefactor</li>
<li>一个赞助实施方为这个慈善机构募捐，称为实施者therunner</li>
<li>想要提供赞助的用户，称为赞助者thesponsor</li>
<li>一个以太坊区块链的挖矿节点，验证交易，称为矿工theminer</li>
</ol>
<p>我们的称为智能赞助(smartSponsor)的合约(contract)是:</p>
<ol>
<li>实施者therunner通过一个募捐活动为慈善机构募捐</li>
<li>构建合约时，实施者therunner命名接受募捐的受益者thebenefactor</li>
<li>实施者therunner然后邀请用户提供赞助，用户调用智能合约的函数(function), 这个函数的功能是从赞助者thesponsor的账号转移以太到合约(contract)中，这些以太沉淀在合约中，直到有回调发生</li>
<li>在合约的整个生命周期，各方都可以看到谁是受益者thebenefactor，募到了多少以太，从谁哪儿募到(当然赞助者thesponsor可以匿名)</li>
</ol>
<p><img src="http://upyun-assets.ethfans.org/uploads/photo/image/eb0bdd5098014980a8bcf3c24cc3ba94.png" alt="合约模型"></p>
<p>合约定了以后，两种现象必有其一：</p>
<p>1.募捐照计划实施，实施者指示合约把全部募捐转移给受益者</p>
<p><img src="http://upyun-assets.ethfans.org/uploads/photo/image/69ad085d0f94498d8d4e70a7be0be2f6.png" alt="合约模型2"></p>
<p>2.因为某种原因募捐实施不了，实施者指示合约把赞助者承诺的募捐退还</p>
<p><img src="http://upyun-assets.ethfans.org/uploads/photo/image/8fb34f670a0447f581c0b675d5651929.png" alt="合约模型3"></p>
<p>以太坊允许智能合约用代码定义，代码使用一种叫Solidity的编程语言。这是一种类似Java的语言。合约就像Java类，区块链交易存储在成员变量中，可以调用合约的方法来查询合约，或者改变合约的状态。由于区块链的拷贝分布在网络中所有的节点，任何人可以查询合约来获取合约中的公有信息。</p>
<p>我们的合约会包含以下方法：</p>
<ol>
<li>smartSponsor –合约的构造器。它初始化合约的状态。合约的构建者命名账户的地址，这个账户会在合约提款时得益。</li>
<li>pledge –可以被任何捐赠以太的赞助者调用。赞助者可以提供支持募捐的信息，但这个不是必需的。</li>
<li>getPot –返回合约中当前的以太总量。</li>
<li>refund –把承诺的募捐退还给赞助者。只有合约的拥有者能够调用这个方法。</li>
<li>drawdown –把合约中的全部募捐转移到受益者账户。同样，只有合约的拥有者能够调用这个方法。</li>
</ol>
<p>我们的想法是合约要有约束：如果赞助者把以太转移到合约，除非整个合约退回，否则赞助者不能取回。如此，所有的数据都公开可取，意思是任何能够访问以太坊的人，通过合约的代码，能够看到谁设置了合约，谁是受益者，谁承诺了哪一笔捐赠。</p>
<p>重要的是，所有改变合约状态的操作(构建，承诺，退还，或者把合约中的全部募捐转移到受益者账户)都需要在区块链中创建交易。这就意味着，交易被“挖矿”和区块被存储以前，数据还没有被存储。有些操作只是读取已经存在的合约状态(getPot或者读取公共成员变量)，这些操作不需要挖矿。这点重要而微妙：写操作很慢(我们必须等到挖矿完成)。或许写操作结果最终进不了区块链(如果你的代码抛出一个异常或者有其他的错误)，需要调用者给矿工干活的激励。这在以太坊术语中称为gas。所有写操作需要支付gas来改变区块链的状态。</p>
<p>我们有幸不需要加入太坊网络和购买以太，就能使用相同的软件，配置一个本地测试区块链，运行一个矿工来产生自己所谓的以太。这样我们不用浪费真的以太，来测试我们的代码。</p>
<h2 id="Solidity-代码"><a href="#Solidity-代码" class="headerlink" title="Solidity 代码"></a>Solidity 代码</h2><p>这里是用Solidity语言写的我们的智能合约的全部代码：（注：这是修改后的代码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">pragma solidity ^0.4.0;</div><div class="line">// Smart contract to allow someone to organise a sponsored event for charity</div><div class="line">// Glynn Bird - 2016</div><div class="line"></div><div class="line">contract smartSponsor &#123;</div><div class="line">  address public owner;</div><div class="line">  address public benefactor;</div><div class="line">  bool public refunded; </div><div class="line">  bool public complete;</div><div class="line">  uint public numPledges;</div><div class="line">  struct Pledge &#123;</div><div class="line">    uint amount;</div><div class="line">    address eth_address;</div><div class="line">    bytes32 message;</div><div class="line">  &#125;</div><div class="line">  mapping(uint =&gt; Pledge) public pledges;</div><div class="line">  </div><div class="line">  // constructor</div><div class="line">  function smartSponsor(address _benefactor) public &#123;</div><div class="line">    owner = msg.sender;</div><div class="line">    numPledges = 0;</div><div class="line">    refunded = false;</div><div class="line">    complete = false;</div><div class="line">    benefactor = _benefactor;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // add a new pledge</div><div class="line">  function pledge(bytes32 _message) public payable &#123;</div><div class="line">    if (msg.value == 0 || complete || refunded) revert();</div><div class="line">    pledges[numPledges] = Pledge(msg.value, msg.sender, _message);</div><div class="line">    numPledges++;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  function getPot() public constant returns (uint) &#123;</div><div class="line">    return this.balance; </div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // refund the backers</div><div class="line">  function refund() public &#123;</div><div class="line">    if (msg.sender != owner || complete || refunded) revert();</div><div class="line">    for (uint i = 0; i &lt; numPledges; ++i) &#123;</div><div class="line">      pledges[i].eth_address.transfer(pledges[i].amount);</div><div class="line">    &#125;</div><div class="line">    refunded = true;</div><div class="line">    complete = true;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // send funds to the contract benefactor</div><div class="line">  function drawdown() public &#123;</div><div class="line">    if (msg.sender != owner || complete || refunded) revert();</div><div class="line">    benefactor.transfer(this.balance);</div><div class="line">    complete = true;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Pledge结构描述一个捐赠，记录赞助者的账号，赞助值，和一个消息字符串</li>
<li>pledges数组记录一组Pledge</li>
<li>所有contract的成员变量都是公共的，因此它们的getter是自动产生的<br>有些函数调用throw来避免在出错时，数据被存储到区块链<br>请注意，代码没有提及交易，区块，gas，或者区块链以及加密货币的任何术语。代码仅仅存储成员变量的状态。以太坊仅仅创建了必要的交易，提交给网络验证(本例采用了我们的测试网络)，然后存储到区块链。所有复杂的东西，都避免让我们看到。结果我们的代码很少(50行)，又容易理解。</li>
</ul>
<p>这个很重要，因为智能合约就是信赖的共享；合约中的所有参与方应该清楚他们的承諾，募捐去了哪里，谁可以做哪些操作。代码越简单，越容易验证合约是否值得信赖。</p>
<h2 id="运行智能合约"><a href="#运行智能合约" class="headerlink" title="运行智能合约"></a>运行智能合约</h2><p>要运营合约，先要把以太坊跑起来。我的Ubuntu服务器安装指南在<a href="https://github.com/glynnbird/smartsponsor。" target="_blank" rel="external">https://github.com/glynnbird/smartsponsor。</a> 我使用的是IBM的Bluemix虚拟机(译注：这个不是必须的)，再用apt-get加些需要的包。</p>
<p>假定你根据我的安装指南，在你的测试网络创建了4个以太坊账号，以及配置了一个挖矿进程， 我们可以拷贝smartSponsor代码，在以太坊控制台执行（也就是说打开了两个窗口，一个用来挖矿另一个执行导入合约的代码）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; git clone https://github.com/glynnbird/smartsponsor.git  // 注：代码有修改</div><div class="line">&gt; cd smartsponsor</div><div class="line">&gt; geth attach</div></pre></td></tr></table></figure>
<p>从geth控制台，执行和以太坊API交互的JavaScript命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; loadScript(&quot;./smartsponsor.js&quot;)</div><div class="line">Contract transaction send: TransactionHash: 0xe797ce5c1e5eeaae6e4bd09ad6564f9deba1beeeb7f09b6c16eec728584e370c waiting to be mined...</div><div class="line">true</div><div class="line">&gt; Contract mined! Address: 0x15590c0417f6421fd35e113db0fdb2055df2344b</div><div class="line">[object Object]</div></pre></td></tr></table></figure>
<p>其中 JavaScript 文件修改成了<a href="https://www.zybuluo.com/PatrickCtyyx/note/972386" target="_blank" rel="external">这篇文章</a>的情况。</p>
<p>smartsponsor.js文件创建了一些变量，它们是我们创建的4个以太坊坊账号的地址(theminer, therunner, thebenefactor, thesponsor),这样接下来的代码片段中，谁做了什么，就容易理解了。该文件还包含一系列的指令，用来编译Solidity源码，构建smartSponsor合约，产生therunner合约实例，确保合约的受益者是thebenefactor。</p>
<p>直到交易被挖矿了，合约才变活。这个需要几秒或几分钟，取决于运行计算机的速度。让我们来观察一下合约（合约赋给了变量ss）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt; ss</div><div class="line">&#123;</div><div class="line">  address: &quot;0xe021f45922e141f5e17d05a4b2721ec972065960&quot;,</div><div class="line">  transactionHash: &quot;0x77ba5bc77f0a62888c08084a7c00cf00b6cc024f88f988e9daada751788c8693&quot;,</div><div class="line">  allEvents: function(),</div><div class="line">  benefactor: function(),</div><div class="line">  complete: function(),</div><div class="line">  drawdown: function(),</div><div class="line">  getPledge: function(),</div><div class="line">  getPot: function(),</div><div class="line">  numPledges: function(),</div><div class="line">  owner: function(),</div><div class="line">  pledge: function(),</div><div class="line">  refund: function(),</div><div class="line">  refunded: function()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以看到合约有一个address，意味着它能收发以太值，以及一个transactionHash，用它来找到区块链中的位置。公共的，可对合约调用的函数也列出了。现在让我们调用几个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; ss.benefactor()</div><div class="line">&quot;0x63de8807ac0bd63be460be0de250749c4df1dcb0&quot;</div><div class="line">&gt; ss.owner()</div><div class="line">&quot;0x458305055882d53663b41a00eebd0b657469843f&quot;</div><div class="line">&gt; ss.getPot()</div><div class="line">0</div><div class="line">&gt; ss.numPledges()</div><div class="line">0</div><div class="line">&gt; ss.complete()</div><div class="line">False</div></pre></td></tr></table></figure>
<p>我们可以看到合约的拥有者和受益者是不同的账号(分别是therunner和thebenefactor)，合约的状态初始化为没有募捐和赞助。从自己的区块链拷贝做读操作，是免费的，所以我们不需要提供gas。</p>
<p>接下来我们寄给thesponsor账号一些钱，原先账号是没有以太的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; personal.unlockAccount(thesponsor,&quot;password&quot;);</div><div class="line">&gt; eth.sendTransaction(&#123;from: theminer, to: thesponsor, value: 100000000000000000&#125;);</div><div class="line">&quot;0xd4fc641311e31abb6546c3503c367c6ac971b0ad9cb4bcd4c56597e3b98d6d7a&quot;</div><div class="line">&gt; eth.getBalance(theminer);</div><div class="line">4.9524805801917e+22</div><div class="line">&gt; eth.getBalance(thesponsor);</div><div class="line">100000000000000000</div></pre></td></tr></table></figure>
<p>接下来认证thesponsor用户，给我们的智能合约赞助一些钱：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; personal.unlockAccount(thesponsor,&quot;password&quot;);</div><div class="line">true</div><div class="line">&gt; ss.pledge(&quot;Good luck with the run!&quot;, &#123;from: thesponsor, value: 10000000, gas: 3000000&#125;);</div><div class="line">&quot;0xc0880c4151946014389e135bcbefe39fb8f786e9e3e0ce077fa5f967e2a31ab3&quot;</div></pre></td></tr></table></figure>
<p>价值参数是我们希望转移到合约的以太数量。10000000似乎很大，但单位是wei。1个以太有1000000000000000000个wei！</p>
<p>返回值是交易标识。我们必须等到交易存储到区块链，才能看到合约状态改变了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; ss.getPot()</div><div class="line">10000000</div><div class="line">&gt; ss.numPledges()</div><div class="line">1</div><div class="line">&gt; ss.pledges(0)</div><div class="line">[10000000, &quot;0x225905462cf12404757852c01edfd2ec0bf0dbe9&quot;, &quot;0x476f6f64206c75636b2077697468207468652072756e21000000000000000000&quot;]</div></pre></td></tr></table></figure>
<p>调用pledges(0)返回第一个捐赠pledge，包含它的价值，赞助者的地址，和消息(以一串字节表示).我们可以不断地调用pledge函数来增加捐赠，并观察pot变大。在7个赞助者捐赠以后，我们有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ss.getPot()</div><div class="line">70000000</div></pre></td></tr></table></figure>
<p>请注意，合约得到了赞助者承诺的全部以太数量，但是赞助者的账号被扣除了比承诺稍多一点的价值。为什么？因为调用pledge函数的操作，必须提供gas作为动力。<br>当实施者准备完成合约，只需调用drawdown函数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; personal.unlockAccount(therunner,&quot;password&quot;);</div><div class="line">true</div><div class="line">&gt; ss.drawdown(&#123;from: therunner, gas:3000000&#125;);</div><div class="line">&quot;0x082424d8057b8c250f8b86cda05211628bb3bae513ce27bf6194445ae035a3c4&quot;</div></pre></td></tr></table></figure>
<p>合约挖矿完成后，我们应该看到受益者的账号收到了合约的捐赠数量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; eth.getBalance(thebenefactor);</div><div class="line">70000000</div><div class="line">&gt; ss.getPot()</div><div class="line">0</div></pre></td></tr></table></figure>
<h3 id="补充：在另一个窗口中打开智能合约："><a href="#补充：在另一个窗口中打开智能合约：" class="headerlink" title="补充：在另一个窗口中打开智能合约："></a>补充：在另一个窗口中打开智能合约：</h3><p>如果想在另一个窗口中打开此智能合约则需要记录下合约的 abi 以及 address:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; abi = your_abi</div><div class="line">&gt; sample = eth.contract(abi)</div><div class="line">&gt; ss2 = sample.at(&quot;your_address&quot;)</div><div class="line">&gt; ss2.getPot</div><div class="line">0</div></pre></td></tr></table></figure>
<p>智能合约在合约里的第三方托管记录多个捐赠，要么转移到受益者，要么退还给赞助者。代码确保只有合约的创建者可以退还捐赠，或者全部转移给受益者，并且防止合约完成后再加捐赠。整个过程中，合约的状态可以被各方查询，这些都包含在50行代码里面！</p>
<p>用geth行命令工具执行的命令实际上是Javascript语句。你用自己的客户端代码同样可以调用远端API,和真实(或测试)网络进行交互。这样，创建基于互联网的智能合约前端就很简单。</p>
<p>你用Mist浏览器可以创建帐户，查看和操作合约，就像一个智能合约的应用商店。Mist设想了很多计划，但目前它是一个相对简单的钱包应用，以及合约浏览器。</p>
<h2 id="区块链仅仅是一个分布式数据库？"><a href="#区块链仅仅是一个分布式数据库？" class="headerlink" title="区块链仅仅是一个分布式数据库？"></a>区块链仅仅是一个分布式数据库？</h2><p>区块链是一种按时间顺序存储数据的账本，它是跨越多个结点的分布式数据库。但和Cloudant分布式数据库的意义不同：它并不是把数据分割成片，使工作量散布，从而每片就能搞定一部分。它的网络中，所有节点必须处理所有的数据变化。还有，挖矿的节点执行工作量证明(proof-of-work)，来证明节点有资格实施所预计的改变，这个造成写数据的过程极度缓慢，以太坊每秒只能处理20-30个交易(不是每个用户20-30个交易，而是全部区块链)。</p>
<p>以太坊不仅是一个数据仓库。它增加了新的功能：在区块链中封装代码和数据。这样参与各方可以确信一个合约能够说到做到。与签过名的纸上合约，律师，公证，银行，保险，清算相比，大有不同。</p>
<h2 id="区块链和智能合约能做什么？"><a href="#区块链和智能合约能做什么？" class="headerlink" title="区块链和智能合约能做什么？"></a>区块链和智能合约能做什么？</h2><p>以太坊只是智能合约平台的一种，用它可以构建基于区块链的应用。最合适的用例有：</p>
<ul>
<li>从一方转移价值到另一方</li>
<li>一方或几方需要匿名</li>
<li>价值必须存储在合约本身，并且存储一段时间</li>
<li>希望避免转移真实货币产生的交易费用 需要建立共识 </li>
<li>希望显示公开性，把状态存储在公共域</li>
<li>需要确保物理或虚拟材料的来源和真实性</li>
</ul>
<p>马上想到的应用有：拍卖，借贷，遗嘱，注册，众筹，股权，和投票。</p>
<p>从金钱和计算角度看，写操作是很贵的，所以智能合约多用在写操作少，但是数据价值高的应用。尽管读操作是免费的，只存在一些简单的查询操作。你可以给存储的数据加索引，但还不像一般的数据库，它不存在查询语言，也不存在抽取或聚合数据的方式。</p>
<p>区块链还有另外一些缺点。所有网络中的参与方要存储所有的区块，数据不是分割成可以分别搞定的片段，所以每个节点必须存储整个数据库，并且处理每一个变化。用工作量证明模型，在网络中分布信赖，是一种聪明的迂回解决方案，但是实际情况下，要用千万个节点消耗能量来证明节点值得信赖。最后一点，以太的价值，就像比特币，买卖受投机影响，使得以太的金融价值不稳定。以太坊在发展规划中有性能提升，可扩展性，替换工作量证明，但是在笔者写此文时，它们还只是愿景。</p>
<h2 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h2><p>中文原文：<a href="http://ethfans.org/posts/block-chain-technology-smart-contracts-and-ethereum" target="_blank" rel="external">http://ethfans.org/posts/block-chain-technology-smart-contracts-and-ethereum</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文仅仅是出于学习的目的，对 King Wang 的译文中的代码部分根据当前版本的工具进行了更新。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;本文征得IBM的Glynn Bird同意翻译发表。虽然文章没有很深的理论，但是它用简洁的语言描述了区块链技术，智能合约，以及以太坊。文章用了一个可以运
    
    </summary>
    
      <category term="BlockChain" scheme="https://blog.patrickcty.cc/categories/BlockChain/"/>
    
    
      <category term="BlockChain" scheme="https://blog.patrickcty.cc/tags/BlockChain/"/>
    
  </entry>
  
  <entry>
    <title>Vue与API请求遇到的坑</title>
    <link href="https://blog.patrickcty.cc/2017/11/07/Vue%E4%B8%8EAPI%E8%AF%B7%E6%B1%82%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
    <id>https://blog.patrickcty.cc/2017/11/07/Vue与API请求遇到的坑/</id>
    <published>2017-11-07T11:18:51.000Z</published>
    <updated>2017-11-07T11:19:49.919Z</updated>
    
    <content type="html"><![CDATA[<h2 id="开始之前"><a href="#开始之前" class="headerlink" title="开始之前"></a>开始之前</h2><p>最近在写比赛项目 TeamSeeker 的代码，后台写得差不多了，于是乎决定写一下网页前端来请求 API，顺便再次测试一下后台的合理性，同时也接触一下一直都想尝试的 Vue。只是没想到居然会遇到这么多坑。</p>
<h2 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑"></a>遇到的坑</h2><h3 id="初始化-Vue-项目"><a href="#初始化-Vue-项目" class="headerlink" title="初始化 Vue 项目"></a>初始化 Vue 项目</h3><p>本来只是准备写单个的 HTML 来组织成前端的，后来想来想去还是跟着教程用 Webpack 来初始化一个比较大的项目。</p>
<p>但是项目是成功初始了，但是在引用第三方的组件的时候，明明已经使用 npm 安装了但是就是引用不了 CSS。</p>
<p>去网上找了一圈发现是没有在项目的配置文件中对这些文件类型进行配置，然而试了半天配置的还是不成功……</p>
<p>最后发现了一个简单的方法，就是在用 npm 安装模块的时候使用 -S 参数，这样就会自动保存在配置中了。这个参数表示保存的意思，等同于 <code>--save</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i materialize-css -S</div></pre></td></tr></table></figure>
<h3 id="发送请求时候的跨域问题"><a href="#发送请求时候的跨域问题" class="headerlink" title="发送请求时候的跨域问题"></a>发送请求时候的跨域问题</h3><p>因为使用的是前后端分离的设计思想，因此难免会产生跨域问题。其实这个问题我之前遇到过，当时是直接在返回的内容中带上 <code>Access-Control-Allow-Origin</code> 这个请求头。</p>
<p>不过坑爹的是，在有的时候，在发送跨域请求之前，浏览器会发送 OPTIONS 请求来检查服务器有没有返回 <code>Access-Control-Allow-Origin</code> 这个请求头从而判断服务器是否支持跨域。于是问题就来了，因为我根本没有定义这个方法，因此也自然不会返回这个请求头了，于是就产生了跨域的问题……</p>
<p>不过这个问题在 Google 上找到了答案，具体原理就是在服务器自定义 Response 类，使得在每次请求后都返回所需要的请求头，这样就可以解决这个问题了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">class MyResponse(Response):</div><div class="line">    def __init__(self, response=None, **kwargs):</div><div class="line">        kwargs[&apos;headers&apos;] = &apos;&apos;</div><div class="line">        headers = kwargs.get(&apos;headers&apos;)</div><div class="line">        # 跨域控制</div><div class="line">        origin = (&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;)</div><div class="line">        methods = (&apos;Access-Control-Allow-Methods&apos;, &apos;HEAD, OPTIONS, GET, POST, DELETE, PUT&apos;)</div><div class="line">        if headers:</div><div class="line">            headers.add(*origin)</div><div class="line">            headers.add(*methods)</div><div class="line">        else:</div><div class="line">            headers = Headers([origin, methods])</div><div class="line">        kwargs[&apos;headers&apos;] = headers</div><div class="line">        return super().__init__(response, **kwargs)</div></pre></td></tr></table></figure>
<p>然后在 <code>create_app</code> 里面使用这个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.response_class = MyResponse</div></pre></td></tr></table></figure>
<p>原文参考<a href="https://blog.zengrong.net/post/2615.html" target="_blank" rel="external">这个博客</a>。</p>
<p>顺便一提，在解决这个问题的时候还出现了一个问题，那就是在请求第二页的时候不管后端前端怎么改都得不到正确的结果，结果找了半天发现是并没有第二页的内容……真的是智障了……</p>
<h3 id="使用-axios-无法将-response-保存下来"><a href="#使用-axios-无法将-response-保存下来" class="headerlink" title="使用 axios 无法将 response 保存下来"></a>使用 axios 无法将 response 保存下来</h3><p>axios 是 Vue 官方推荐的 AJAX 请求发送的模块，一个 GET 请求是这样发送的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">axios.get(&apos;http://example.com/api/index&apos;, &#123;</div><div class="line">    params: &#123;</div><div class="line">      &quot;page&quot;: page</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">    .then(function (response) &#123;</div><div class="line">      console.log(response);</div><div class="line">    &#125;)</div><div class="line">    .catch(function (error) &#123;</div><div class="line">      console.log(error);</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>但是我如果想保存 response 对象到 Vue 的一个对象中（需要使用 this） 来访问，如果直接使用 <code>this.$store.dispatch(&#39;getIndex&#39;, response.data);</code> 是不能保存进去的，原因在于 this 在 axios.get() 函数中也起作用，在函数中的作用域就不是 Vue 的对象了，因此我们要在调用函数之前把 this 赋值给另一个变量，然后再用另一个变量来引用 Vue 的对象的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var _self = this;</div><div class="line">axios.get(</div><div class="line">    ...</div><div class="line">    _this.$store.dispatch(&apos;getIndex&apos;, response.data);</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="数据首次加载"><a href="#数据首次加载" class="headerlink" title="数据首次加载"></a>数据首次加载</h3><p>这个到现在还是不是很清楚，先留个坑。</p>
<h3 id="使用-axios-发送-POST-请求遇到的坑"><a href="#使用-axios-发送-POST-请求遇到的坑" class="headerlink" title="使用 axios 发送 POST 请求遇到的坑"></a>使用 axios 发送 POST 请求遇到的坑</h3><p>继使用 axios 发送 GET 请求遇到坑之后，用 POST 请求又踩到了坑，真的是体验极差啊（哭。</p>
<p>这次又是什么问题呢？那就是：</p>
<blockquote>
<p>Request header field Access-Control-Allow-Headers is not allowed by Access-Control-Allow-Headers</p>
</blockquote>
<p>为什么会出现这个问题呢？又是 OPTIONS 这个磨人的小妖精……StackOverflow 上是这样解释的：</p>
<blockquote>
<p>For cross-domain requests, setting the content type to anything other than application/x-www-form-urlencoded, multipart/form-data, or text/plain will trigger the browser to send a preflight OPTIONS request to the server.</p>
</blockquote>
<p>而 axios 发送 POST 请求的时候默认是用 JSON 作为 Content-Type 来发送了，而这正好不是上面的这些，因此就又要提前发送一次 OPTIONS 请求，而正好我又没有对这个处理……</p>
<p>不过这次就不用改服务器的代码了，axios 官方已经给出了解决方法了，那就是把 Content-Type 设置为 <code>application/x-www-form-urlencoded</code>，然后再对 JSON 数据进行处理，具体方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var qs = require(&apos;qs&apos;);</div><div class="line">axios.post(&apos;http://example.com/api/wxlogin&apos;,    </div><div class="line">    qs.stringify(&#123;</div><div class="line">        js_code: &apos;001U3te40K6KSD1Bpaf40DKAe40U3tel&apos;</div><div class="line">    &#125;)</div><div class="line">)</div><div class="line">    .then(function (response) &#123;</div><div class="line">        console.log(response);</div><div class="line">    &#125;)</div><div class="line">    .catch(function (error) &#123;</div><div class="line">        console.log(&apos;aaa&apos;, error);</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>当然这个 qs 模块也是要事先安装的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i qs -S</div></pre></td></tr></table></figure>
<h3 id="使用-font-awesome-但是死活引入不了-CSS"><a href="#使用-font-awesome-但是死活引入不了-CSS" class="headerlink" title="使用 font-awesome 但是死活引入不了 CSS"></a>使用 font-awesome 但是死活引入不了 CSS</h3><p>网站当然少不了图标，一个比较简单好用的方法就是使用 font-awesome 提供的图标，平常我都是使用 CDN 来引入的，但是这个项目结构下好像不适合直接引入，而是应该使用 npm 安装模块。</p>
<p>但是安装之后死活找不到安装好的模块，也就无法引入了。于是不得不去安装 vue-awesome，然而这个的图标死活和文字对齐不了……这个简直不能忍啊，最后不得不又得回到 font-awesome。</p>
<p>又找了一圈之后发现是我安装的方法不对，我一开始是使用下面这个来安装的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i fontawesome -S（不要用这个安装！！！）</div></pre></td></tr></table></figure>
<p>确实提示已经安装成功了，但是不能用。我之后又使用了下面这个来安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i font-awesome -S</div></pre></td></tr></table></figure>
<p>加了中间这个短横线之后就可以引入了……虽然我发现安装后的提示都是一样的……简直坑爹啊……还是我大 Python 的 pip 要好用……</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这几天真的踩了超多的坑，简单的一个页面结果写了一周才大概完成……中间的心酸真的是只有自己知道了……</p>
<p>最近一段时间也是事情堆起来了……哎只希望下次驾照考试能顺利一点吧……已经成了我心中的梦魇了……真的很害怕很无助……</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;开始之前&quot;&gt;&lt;a href=&quot;#开始之前&quot; class=&quot;headerlink&quot; title=&quot;开始之前&quot;&gt;&lt;/a&gt;开始之前&lt;/h2&gt;&lt;p&gt;最近在写比赛项目 TeamSeeker 的代码，后台写得差不多了，于是乎决定写一下网页前端来请求 API，顺便再次测试一下后
    
    </summary>
    
      <category term="Fronted" scheme="https://blog.patrickcty.cc/categories/Fronted/"/>
    
    
      <category term="Fronted" scheme="https://blog.patrickcty.cc/tags/Fronted/"/>
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/tags/Flask/"/>
    
      <category term="Vue" scheme="https://blog.patrickcty.cc/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>MATLAB一些操作</title>
    <link href="https://blog.patrickcty.cc/2017/11/07/MATLAB%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/"/>
    <id>https://blog.patrickcty.cc/2017/11/07/MATLAB一些操作/</id>
    <published>2017-11-07T11:17:48.000Z</published>
    <updated>2017-11-07T11:18:24.427Z</updated>
    
    <content type="html"><![CDATA[<h2 id="syms"><a href="#syms" class="headerlink" title="syms"></a>syms</h2><p>使用 syms 关键字可以定义自变量，这样就可以写出带 x，y，z 等的表达式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">syms x, y;</div><div class="line"></div><div class="line">y = exp(-2 * x);</div></pre></td></tr></table></figure>
<h2 id="prod"><a href="#prod" class="headerlink" title="prod"></a>prod</h2><p>使用 prod 可以实现矩阵中的元素连乘的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x = [3 4 5];</div><div class="line">prod(x)</div><div class="line">&gt;&gt; 120</div></pre></td></tr></table></figure>
<h2 id="循环遍历一个向量"><a href="#循环遍历一个向量" class="headerlink" title="循环遍历一个向量"></a>循环遍历一个向量</h2><p>直接把向量赋值给循环变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a = [4 5 6]；</div><div class="line"></div><div class="line">for i = a</div><div class="line">    % disp 为输出语句</div><div class="line">    disp(i);</div><div class="line">end</div></pre></td></tr></table></figure>
<h2 id="subs"><a href="#subs" class="headerlink" title="subs"></a>subs</h2><p>subs 用来替换。</p>
<p>假设 poly 是一个以 x 为自变量的多项式，如果要计算某个值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">subs(poly, x, 5)</div></pre></td></tr></table></figure>
<h2 id="在向量中增加元素"><a href="#在向量中增加元素" class="headerlink" title="在向量中增加元素"></a>在向量中增加元素</h2><p>假设 event 是一个向量，如果要增加一个 b 向量在尾部，则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event = [event b]</div></pre></td></tr></table></figure>
<h2 id="ezplot"><a href="#ezplot" class="headerlink" title="ezplot"></a>ezplot</h2><p>ezplot 用来画出某个带自变量的表达式的曲线，可以指定自变量的范围。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">% polyresult 为多项式表达式</div><div class="line">ezplot(polyresult, [-1, 1]);</div></pre></td></tr></table></figure>
<h2 id="plot"><a href="#plot" class="headerlink" title="plot"></a>plot</h2><p>最基本的画曲线的函数，根据横纵坐标。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plot(x0, errevent, &apos;--&apos;, x0, errcheby);</div></pre></td></tr></table></figure>
<h2 id="figure"><a href="#figure" class="headerlink" title="figure"></a>figure</h2><p>新建一张画布，下一个图就会画在这个画布上了。</p>
<h2 id="hold-on-amp-hold-off"><a href="#hold-on-amp-hold-off" class="headerlink" title="hold on &amp; hold off"></a>hold on &amp; hold off</h2><p>用来把多个曲线画在同一个坐标系中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">figure;</div><div class="line">ezplot(polyresult, [-1, 1]);</div><div class="line">hold on;</div><div class="line">syms x0;</div><div class="line">ezplot(exp(-2 * x0), [-1, 1]);</div><div class="line">hold off;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;syms&quot;&gt;&lt;a href=&quot;#syms&quot; class=&quot;headerlink&quot; title=&quot;syms&quot;&gt;&lt;/a&gt;syms&lt;/h2&gt;&lt;p&gt;使用 syms 关键字可以定义自变量，这样就可以写出带 x，y，z 等的表达式。&lt;/p&gt;
&lt;figure class=&quot;hi
    
    </summary>
    
      <category term="课程" scheme="https://blog.patrickcty.cc/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
      <category term="MATLAB" scheme="https://blog.patrickcty.cc/tags/MATLAB/"/>
    
      <category term="数值分析" scheme="https://blog.patrickcty.cc/tags/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>数据库ROLLUP与CUBE</title>
    <link href="https://blog.patrickcty.cc/2017/11/07/%E6%95%B0%E6%8D%AE%E5%BA%93ROLLUP%E4%B8%8ECUBE/"/>
    <id>https://blog.patrickcty.cc/2017/11/07/数据库ROLLUP与CUBE/</id>
    <published>2017-11-07T11:16:27.000Z</published>
    <updated>2017-11-07T11:17:14.874Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>ROLLUP 和 CUBE 都是用来在差查询结果中生成合计的项目。</p>
<p>这两个关键字需要和 GROUP BY 来一起使用，需要注意的是 GROUP BY 关键字后面可以跟多个列名，这多个列名之间的顺序和输出的顺序是相关的。</p>
<p>ROLLUP 和 CUBE 的操作都要依赖 GROUP BY。</p>
<h2 id="GROUPING"><a href="#GROUPING" class="headerlink" title="GROUPING"></a>GROUPING</h2><p>GROUPING 用来区分是本来内容就是 null 还是是因为 ROLLUP 和 CUBE 而产生的 null 值，如果是后者那么 GROUPING(列名) 返回的结果就是 1，否则则是零。</p>
<p>ROLLUP 统计的时候会默认生成 null，这时候就需要自己填入统计的结果了。</p>
<h2 id="ROLLUP"><a href="#ROLLUP" class="headerlink" title="ROLLUP"></a>ROLLUP</h2><p>ROLLUP 产生的合计项目和 GROUP BY 中的多个列名的顺序有关。</p>
<p>ROLLUP 会根据 GROUP BY 的第一个列来进行分组并且输出汇总的内容。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">select case when grouping(city) = 1 then &apos;ALL&apos;</div><div class="line">	else city </div><div class="line">	end as city,</div><div class="line">	case when grouping(state) = 1 then &apos;ALL&apos;</div><div class="line">	else state</div><div class="line">	end as state</div><div class="line">from pubs.dbo.authors</div><div class="line">group by city, state with rollup;</div></pre></td></tr></table></figure>
<p>运行结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Ann Arbor	MI</div><div class="line">Ann Arbor	ALL</div><div class="line">……省略若干行</div><div class="line">Vacaville	CA</div><div class="line">Vacaville	ALL</div><div class="line">Walnut Creek	CA</div><div class="line">Walnut Creek	ALL</div><div class="line">ALL	ALL</div></pre></td></tr></table></figure></p>
<p>在这里是对应的每个不同的州进行分组，然后对每个组进行汇总，最终对所有的州再进行一次汇总。</p>
<h2 id="CUBE"><a href="#CUBE" class="headerlink" title="CUBE"></a>CUBE</h2><p>CUBE 产生的合计项目和 GROUP BY 中的多个列名的顺序在某种程度上可以说是无关。</p>
<p>CUBE 产生的结果不仅会产生 ROLLUP 的结果，还会产生 ROLLUP 中没出现的另一种顺序的结果。</p>
<p>例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">select case when grouping(city) = 1 then &apos;ALL&apos;</div><div class="line">	else city </div><div class="line">	end as city,</div><div class="line">	case when grouping(state) = 1 then &apos;ALL&apos;</div><div class="line">	else state</div><div class="line">	end as state</div><div class="line">from pubs.dbo.authors</div><div class="line">group by city, state with cube;</div></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">Berkeley	CA</div><div class="line">Covelo	CA</div><div class="line">Menlo Park	CA</div><div class="line">Oakland	CA</div><div class="line">Palo Alto	CA</div><div class="line">San Francisco	CA</div><div class="line">San Jose	CA</div><div class="line">Vacaville	CA</div><div class="line">Walnut Creek	CA</div><div class="line">ALL	CA</div><div class="line">Gary	IN</div><div class="line">ALL	IN</div><div class="line">Lawrence	KS</div><div class="line">ALL	KS</div><div class="line">Rockville	MD</div><div class="line">ALL	MD</div><div class="line">Ann Arbor	MI</div><div class="line">ALL	MI</div><div class="line">Corvallis	OR</div><div class="line">ALL	OR</div><div class="line">Nashville	TN</div><div class="line">ALL	TN</div><div class="line">Salt Lake City	UT</div><div class="line">ALL	UT</div><div class="line">ALL	ALL</div><div class="line">Ann Arbor	ALL</div><div class="line">Berkeley	ALL</div><div class="line">Corvallis	ALL</div><div class="line">Covelo	ALL</div><div class="line">Gary	ALL</div><div class="line">Lawrence	ALL</div><div class="line">Menlo Park	ALL</div><div class="line">Nashville	ALL</div><div class="line">Oakland	ALL</div><div class="line">Palo Alto	ALL</div><div class="line">Rockville	ALL</div><div class="line">Salt Lake City	ALL</div><div class="line">San Francisco	ALL</div><div class="line">San Jose	ALL</div><div class="line">Vacaville	ALL</div><div class="line">Walnut Creek	ALL</div></pre></td></tr></table></figure></p>
<p>如果忽视输出数据的顺序，那么这个结果相当于两个 ROLLUP 的结果作 UNION<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">select case when grouping(city) = 1 then &apos;ALL&apos;</div><div class="line">	else city </div><div class="line">	end as city,</div><div class="line">	case when grouping(state) = 1 then &apos;ALL&apos;</div><div class="line">	else state</div><div class="line">	end as state</div><div class="line">from pubs.dbo.authors</div><div class="line">group by city, state with rollup</div><div class="line">union</div><div class="line">select case when grouping(city) = 1 then &apos;ALL&apos;</div><div class="line">	else city </div><div class="line">	end as city,</div><div class="line">	case when grouping(state) = 1 then &apos;ALL&apos;</div><div class="line">	else state</div><div class="line">	end as state</div><div class="line">from pubs.dbo.authors</div><div class="line">group by state, city with rollup;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;概览&quot;&gt;&lt;a href=&quot;#概览&quot; class=&quot;headerlink&quot; title=&quot;概览&quot;&gt;&lt;/a&gt;概览&lt;/h2&gt;&lt;p&gt;ROLLUP 和 CUBE 都是用来在差查询结果中生成合计的项目。&lt;/p&gt;
&lt;p&gt;这两个关键字需要和 GROUP BY 来一起使用，需要注意
    
    </summary>
    
      <category term="课程" scheme="https://blog.patrickcty.cc/categories/%E8%AF%BE%E7%A8%8B/"/>
    
    
      <category term="SQL Server" scheme="https://blog.patrickcty.cc/tags/SQL-Server/"/>
    
      <category term="数据库" scheme="https://blog.patrickcty.cc/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>微信小程序学习</title>
    <link href="https://blog.patrickcty.cc/2017/11/07/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0/"/>
    <id>https://blog.patrickcty.cc/2017/11/07/微信小程序学习/</id>
    <published>2017-11-07T11:14:01.000Z</published>
    <updated>2017-11-07T11:14:53.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>全局配置文件为 app.json，在项目的根目录中。</p>
<p>配置详情参考<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/config.html" target="_blank" rel="external">官方文档</a>。</p>
<p>要注意的是主体页面的颜色要和微信的颜色保持一致为白色，但是状态栏以及标签页这些地方可以是自己喜欢的颜色。</p>
<h2 id="登录状态的维护"><a href="#登录状态的维护" class="headerlink" title="登录状态的维护"></a>登录状态的维护</h2><p>和其他媒介一样，微信小程序本质上是内容的载体，因而我们也要有一个后台服务器来为小程序提供内容。</p>
<p>从小程序登录微信是极其容易的一件事情，但是我们的后台 api 怎么知道用户是不是真的登录了呢？那就要通过微信提供的 api 来验证了。</p>
<p>在微信的 <code>wx.login()</code> api 中，如果成功登录，则会返回一个登录凭证 code，小程序可以把这个 code 传递给 后台服务器，然后后台服务器通过调用微信的验证 api 来测试登录状态，如果成功则会返回 session_key 到后台服务器（这个 session_key 是密钥，不应该传输到小程序客户端）。</p>
<p>而小程序和普通的浏览器不一样，是不能存储 cookie 的，因此 cookie 相关应该存储到服务器中，而服务器应该把存储 cookie 的 key 来返回给小程序，小程序之后就通过这个 key 来向服务器进行请求。</p>
<p>注意这里有两个登录状态，一个是小程序中微信号的登录状态，第二个是服务器中的登录状态。后者是依托于前者，如果前者过期重新登录，则必须要更新服务的的登录状态。</p>
<p>这样设置的好处是控制了服务器的资源不能被随意获取。</p>
<p><a href="http://www.jianshu.com/p/c5f6c98b2685" target="_blank" rel="external">参考资料</a></p>
<h2 id="杂"><a href="#杂" class="headerlink" title="杂"></a>杂</h2><p><code>wx.getStorageSync(key)</code> 是用来从本地缓存中同步获取指定 key 对应的内容。</p>
<p><code>wx.setStorageSync(key, value)</code> 把 value 存储到相应的 key 对应的内容中，会覆盖掉原来 key 对应的内容。</p>
<p><code>.unshift()</code> Array 的方法，用来在数组的首部添加一个或多个元素，添加几个元素就有几个参数。</p>
<p><code>.map()</code> Array 的方法，用 map 中的函数来处理 Array 中的每个数据。</p>
<p><code>=&gt;</code> 用来定义箭头函数，这个函数表达式的语法比函数表达式短。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 一个参数时圆括号是可选的</div><div class="line">singleParam =&gt; &#123; statements; &#125;</div><div class="line">(singleParam) =&gt; &#123; statements; &#125;</div><div class="line"></div><div class="line">(param1, param2, …, paramN) =&gt; &#123; statements; &#125;</div><div class="line">(param1, param2, …, paramN) =&gt; expression</div><div class="line">// 等价于：(param1, param2, …, paramN) =&gt; &#123; return expression; &#125;</div><div class="line">/* 当删除大括号时，它将是一个隐式的返回值，这意味着我们不需要指定我们返回*/</div><div class="line"></div><div class="line">// 没有参数时必须要使用圆括号</div><div class="line">() =&gt; &#123; statements; &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;配置文件&quot;&gt;&lt;a href=&quot;#配置文件&quot; class=&quot;headerlink&quot; title=&quot;配置文件&quot;&gt;&lt;/a&gt;配置文件&lt;/h2&gt;&lt;p&gt;全局配置文件为 app.json，在项目的根目录中。&lt;/p&gt;
&lt;p&gt;配置详情参考&lt;a href=&quot;https://mp.we
    
    </summary>
    
      <category term="Fronted" scheme="https://blog.patrickcty.cc/categories/Fronted/"/>
    
    
      <category term="Fronted" scheme="https://blog.patrickcty.cc/tags/Fronted/"/>
    
      <category term="微信小程序" scheme="https://blog.patrickcty.cc/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>Consensus Algorithms</title>
    <link href="https://blog.patrickcty.cc/2017/09/27/ConsensusAlgorithms/"/>
    <id>https://blog.patrickcty.cc/2017/09/27/ConsensusAlgorithms/</id>
    <published>2017-09-27T01:34:39.000Z</published>
    <updated>2017-10-04T00:11:35.566Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PoW-Proof-of-Work"><a href="#PoW-Proof-of-Work" class="headerlink" title="PoW(Proof of Work)"></a>PoW(Proof of Work)</h2><h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>PoW is a consensus strategy used in Bitcoin network.</p>
<p>In PoW, each node of the network is calculating a hash value of the constantly changing block header.</p>
<p>The consensus requires that the calculated value must be equal or small than a certain given value.</p>
<p>When one node obtains the relevant value, all other nodes must mutally validated in case of frauds. Then a new block is added to the blockchain.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>Bitcoin network regard the blockchain head as the input, including:</p>
<ul>
<li>version number(4 Bytes)</li>
<li>previous block hash(32 Bytes)</li>
<li>Merkle root(32 Bytes, formed by transactions in current block)</li>
<li>timestamp(4 Bytes)</li>
<li>bits(4 Bytes, representing the difficulty of the calculation)</li>
<li>nonce(4 Bytes, a random number, by changing which miners guess the solution)</li>
</ul>
<p>As has been mentioned above, miners changes the value of the nonce(and the timestamp) to guess the solution. And the function that is used to calculate the result is SHA256.</p>
<p>The solution or the target value is controlled by ‘bits’, and here is the computational formula：</p>
<blockquote>
<p>targe value = max target value / bits</p>
</blockquote>
<p>And max target value is a constant value:</p>
<blockquote>
<p>0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</p>
</blockquote>
<p>That is to say, the larger the ‘bits’ value is, the harder the target value can be guessed.</p>
<p>Above all, the procedures botcoin miners do to prove their work can be concluded with three steps:</p>
<ul>
<li>generate the Merkle Root Hash using transactions</li>
<li>combine all the fields as the input</li>
<li>change the nonce value in the blockchain head and calculate SHA256(SHA256(Block_Header)), compare it with the target value, if it is smaller then the proof is done</li>
</ul>
<h3 id="Other-PoW-Protocols"><a href="#Other-PoW-Protocols" class="headerlink" title="Other PoW Protocols"></a>Other PoW Protocols</h3><p>PoW needs a lot of computer calculations which is a waste of resources. To take advantage of the loss, some PoW protocols are designed to have some side-applications.</p>
<ul>
<li>Primecoin searches for special prime number chains to be used in mathematical research.</li>
<li>PoB(Proof of Burn) uses bitcoin instead of electricity to mine blocks.(It’s kind of similar to buying a lottery)</li>
</ul>
<h2 id="PoS-Proof-of-Stake"><a href="#PoS-Proof-of-Stake" class="headerlink" title="PoS(Proof of Stake)"></a>PoS(Proof of Stake)</h2><h3 id="Explanation-1"><a href="#Explanation-1" class="headerlink" title="Explanation"></a>Explanation</h3><p>PoS requires people to prove the ownership of the amount of currency, which means that preople with more currencies is more likely to forge the next block.</p>
<p>To avoid the result that the single richest prople domain the network, solutions are often proposed with the combination of the stake size. </p>
<p>P.S. PoS still has to calculate the hash value.</p>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>Blackcoin uses a formula that looks for the lowest hash value in combination with the size of the stake.</p>
<p>In peercoin, older and larger sets of coins have a greater probability of mining the next block.</p>
<h2 id="PBFT-Practical-Byzantine-Fault-Tolerance"><a href="#PBFT-Practical-Byzantine-Fault-Tolerance" class="headerlink" title="PBFT(Practical Byzantine Fault Tolerance)"></a>PBFT(Practical Byzantine Fault Tolerance)</h2><h3 id="Explanation-2"><a href="#Explanation-2" class="headerlink" title="Explanation"></a>Explanation</h3><p>PBFT is a replication algorithm to tolerate byzantine faults.</p>
<p>A new block is determined in a round. </p>
<p>In each round, a primary would be selected according to some rules. And it is responsible for ording the transaction.</p>
<p>The whole process could be divided into three phrases: pre-prepared, prepared and commit. In each phrase, a node would enter next phrase if it has received votes from over 2/3 of all nodes.</p>
<p>P.S. PBFT requires that every node is known to the network.</p>
<h2 id="DPoS-Delegated-Proof-of-Stake"><a href="#DPoS-Delegated-Proof-of-Stake" class="headerlink" title="DPoS(Delegated Proof of Stake)"></a>DPoS(Delegated Proof of Stake)</h2><h3 id="Explanation-3"><a href="#Explanation-3" class="headerlink" title="Explanation"></a>Explanation</h3><p>In DPoS, miners get their priority to generate the blocks according to their stake. </p>
<p>Stakeholders elect their delegates to generate and validate a block, which will significantly improve the speed of confirmation.</p>
<p>Besides, the parameters of the network such as block size and block intervals could be tuned by elected delegates.</p>
<p>P.S. DPoS still has to calculate the hash value.</p>
<h2 id="Ripple"><a href="#Ripple" class="headerlink" title="Ripple"></a>Ripple</h2><h3 id="Explanation-4"><a href="#Explanation-4" class="headerlink" title="Explanation"></a>Explanation</h3><p>Ripple is a consensus algorithm that utilizes collectively-trusted subnetworks within the large network.</p>
<p>In this network, nodes are divided into two types:</p>
<ul>
<li>server: participate consensus process</li>
<li>client: only transfer funds</li>
</ul>
<p>In PBFT, nodes have to ask every node, but in Ripple each node only has a Unique Node List(UNL) to query.</p>
<p>When determining whether to put a transaction into the ledger, the server would query the nodes in UNL. If the received agreements have reached 80%, the transaction would be packed into the ledger.</p>
<h2 id="Tendermint"><a href="#Tendermint" class="headerlink" title="Tendermint"></a>Tendermint</h2><h3 id="Explanation-5"><a href="#Explanation-5" class="headerlink" title="Explanation"></a>Explanation</h3><p>In Tendermint, a new node is determined in a round. </p>
<p>A propser would be selected to broadcast an unconfirmed block in this round.</p>
<p>It would be devided into three steps:</p>
<ol>
<li>Prevote </li>
<li>Precommit</li>
<li>Commit</li>
</ol>
<p>Only if the node has received 2/3 or the agreement can it reach the next step. And when the node has received 2/3 of the commits, it accepts the block.</p>
<p>It’s similar to PBFT, but in this method nodes have to lock their coins to become validators.</p>
<p>P.S. Tendermint requires that every node is known to the network.</p>
<h2 id="More-Infomation"><a href="#More-Infomation" class="headerlink" title="More Infomation"></a>More Infomation</h2><ul>
<li><a href="http://www.infoq.com/cn/articles/bitcoin-and-block-chain-part02" target="_blank" rel="external">PoW</a></li>
<li><a href="http://www.jianshu.com/p/1e2acd3cbd9f" target="_blank" rel="external">PBFT</a></li>
<li><a href="http://blog.csdn.net/lsttoy/article/details/61624287" target="_blank" rel="external">PoW</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;PoW-Proof-of-Work&quot;&gt;&lt;a href=&quot;#PoW-Proof-of-Work&quot; class=&quot;headerlink&quot; title=&quot;PoW(Proof of Work)&quot;&gt;&lt;/a&gt;PoW(Proof of Work)&lt;/h2&gt;&lt;h3 id=&quot;Exp
    
    </summary>
    
      <category term="区块链" scheme="https://blog.patrickcty.cc/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
      <category term="区块链" scheme="https://blog.patrickcty.cc/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
      <category term="算法" scheme="https://blog.patrickcty.cc/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Flask常用扩展用法（二）</title>
    <link href="https://blog.patrickcty.cc/2017/09/23/Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E7%94%A8%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://blog.patrickcty.cc/2017/09/23/Flask常用扩展用法（二）/</id>
    <published>2017-09-23T03:16:56.000Z</published>
    <updated>2017-09-23T03:18:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Flask-Restful"><a href="#Flask-Restful" class="headerlink" title="Flask-Restful"></a>Flask-Restful</h2><p>具体内容参考之前的<a href="https://blog.patrickcty.cc/2017/08/10/%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Flask%E4%B8%ADRESTfulAPI/">文章</a>。</p>
<h2 id="Flask-Celery"><a href="#Flask-Celery" class="headerlink" title="Flask-Celery"></a>Flask-Celery</h2><p>这个用法比较多，之前的两篇文章也有总结过，可以参考之前的内容：</p>
<ul>
<li><a href="https://blog.patrickcty.cc/2017/09/01/%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Flask%E4%B8%ADCelery%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E4%B8%80%EF%BC%89/">第一篇</a></li>
<li><a href="https://blog.patrickcty.cc/2017/09/03/%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Flask%E4%B8%ADCelery%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89/">第二篇</a></li>
</ul>
<h2 id="Flask-Debugtool"><a href="#Flask-Debugtool" class="headerlink" title="Flask-Debugtool"></a>Flask-Debugtool</h2><p>如同这个扩展的名字一样，这个扩展的作用就是为了使调试 Flask 应用变得更加的轻松愉快。</p>
<p>注意：这个扩展只有在配置文件的 Debug = True 的时候才会生效。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask_debugtoolbar import DebugToolbarExtension</div><div class="line"></div><div class="line">debug_toolbar = DebugToolbarExtension()</div><div class="line">debug_toolbar.init_app(app)</div></pre></td></tr></table></figure>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>默认情况下，Flask Debug Tool 会拦截 HTTP 302 重定向请求，修改配置文件来禁止这个行为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DEBUG_TB_INTERCEPT_REDIRECTS = False</div></pre></td></tr></table></figure>
<h2 id="Flask-Cache"><a href="#Flask-Cache" class="headerlink" title="Flask-Cache"></a>Flask-Cache</h2><p>一个强大的缓存工具，可以有效减少数据库等的查询次数，从而极大程度加快页面的访问速度。</p>
<h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask_cache import Cache</div><div class="line"></div><div class="line">cache = Cache()</div><div class="line">cache.init_app(app)</div></pre></td></tr></table></figure>
<h3 id="配置缓存输出结果"><a href="#配置缓存输出结果" class="headerlink" title="配置缓存输出结果"></a>配置缓存输出结果</h3><p>这里是把结果保存在内存的一个 Python 字典里面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CACHE_TYPE = &apos;simple&apos;</div></pre></td></tr></table></figure></p>
<h3 id="缓存函数和视图"><a href="#缓存函数和视图" class="headerlink" title="缓存函数和视图"></a>缓存函数和视图</h3><h4 id="缓存视图函数"><a href="#缓存视图函数" class="headerlink" title="缓存视图函数"></a>缓存视图函数</h4><p>只用在函数上添加一个装饰器就可以缓存这个视图函数的输出结果了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@blog_print.route(&apos;/&apos;)</div><div class="line">@blog_print.route(&apos;/&lt;int:page&gt;&apos;)</div><div class="line">@cache.cached(timeout=60)</div><div class="line">def home(page=1):</div><div class="line">    posts = Post.query.order_by(</div><div class="line">        Post.publish_time.desc()</div><div class="line">    ).paginate(page, 10)</div><div class="line">    recent, top_tags = sidebar_data()</div><div class="line"></div><div class="line">    return render_template(</div><div class="line">        &apos;home.html&apos;,</div><div class="line">        posts=posts,</div><div class="line">        recent=recent,</div><div class="line">        top_tags=top_tags</div><div class="line">    )</div></pre></td></tr></table></figure>
<p>timeout 表示结果缓存的时长，超过这个时长就会再次执行函数取得新的缓存结果。</p>
<h4 id="缓存不带参数的函数"><a href="#缓存不带参数的函数" class="headerlink" title="缓存不带参数的函数"></a>缓存不带参数的函数</h4><p>非视图函数也可以缓存，不过要加入 key_prefix 参数，这个参数用来表示函数的运行结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@cache.cached(timeout=7200, key_prefix=&apos;sidebar_data&apos;)</div><div class="line">def sidebar_data():</div><div class="line">    recent = Post.query.order_by(</div><div class="line">        Post.publish_time.desc()</div><div class="line">    ).limit(5).all()</div><div class="line">    # 下面这个查询不是很理解，join 和 group_by 这两个的用法没怎么接触过</div><div class="line">    top_tags = db.session.query(</div><div class="line">        Tag, func.count(tags.c.post_id).label(&apos;total&apos;)</div><div class="line">    ).join(</div><div class="line">        tags</div><div class="line">    ).group_by(Tag).limit(5).all()</div><div class="line"></div><div class="line">    return recent, top_tags</div></pre></td></tr></table></figure>
<h4 id="缓存带参数的函数"><a href="#缓存带参数的函数" class="headerlink" title="缓存带参数的函数"></a>缓存带参数的函数</h4><p>对于需要接受参数的函数，就不能直接加上装饰器了，不然每次运行的结果都是相同，这时候我们可以使用 memorize 函数来解决这个问题。</p>
<p>memorize 函数不但会储存函数的运行结果，还会储存调用时的参数，括号里面表示的也是缓存的秒数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@staticmethod</div><div class="line">@cache.memoize(60)</div><div class="line">def verify_auth_token(token):</div><div class="line">    s = Serializer(current_app.config[&apos;SECRET_KEY&apos;])</div><div class="line"></div><div class="line">    try:</div><div class="line">        data = s.loads(token)</div><div class="line">    except SignatureExpired:</div><div class="line">        return None</div><div class="line">    except BadSignature:</div><div class="line">        return None</div><div class="line">    user = User.query.get(data[&apos;id&apos;])</div><div class="line">    return user</div></pre></td></tr></table></figure>
<h3 id="使用-redis-作为缓存后端"><a href="#使用-redis-作为缓存后端" class="headerlink" title="使用 redis 作为缓存后端"></a>使用 redis 作为缓存后端</h3><p>redis 我们在 Flask-Celery 里面用到过，用来储存消息队列相关内容，在这里我们也可以利用 redis 来缓存更多的结果。</p>
<p>只用修改配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class ProdConfig(Config):</div><div class="line">    CACHE_TYPE = &apos;redis&apos;</div><div class="line">    CACHE_REDIS_HOST = &apos;localhost&apos;</div><div class="line">    CACHE_REDIS_PORT = &apos;6379&apos;</div><div class="line">    CACHE_REDIS_PASSWORD = &apos;&apos;</div><div class="line">    CACHE_REDIS_DB = &apos;0&apos;</div></pre></td></tr></table></figure>
<h2 id="Flask-Admin"><a href="#Flask-Admin" class="headerlink" title="Flask-Admin"></a>Flask-Admin</h2><p>强大的管理员管理界面，省去了不少造轮子的功夫。</p>
<h3 id="初始化-2"><a href="#初始化-2" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask_admin import Admin</div><div class="line"></div><div class="line">admin = Admin()</div><div class="line">admin.init_app(app)</div></pre></td></tr></table></figure>
<p>初始化之后这个扩展就自动在 localhost:5000/admin 处显示出了相应的管理员页面。</p>
<h3 id="编写基础管理页面"><a href="#编写基础管理页面" class="headerlink" title="编写基础管理页面"></a>编写基础管理页面</h3><p>BaseView 是用来在 admin 的主界面添加相应的视图选项。</p>
<p>现在我们在 localhost:5000/admin 之后添加一个 customview 的选项。例如生成 localhost:5000/admin/customview/ 的路径</p>
<p>由于也要创建视图，所以在视图函数所在的文件/文件夹 里面加入以下的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">from flask_admin import BaseView, expose</div><div class="line"></div><div class="line">class CustomView(BaseView):</div><div class="line">    @expose(&apos;/&apos;)</div><div class="line">    @login_required</div><div class="line">    @admin_permission.require(http_exception=403)</div><div class="line">    def index(self):</div><div class="line">        return self.render(&apos;admin/custom.html&apos;)</div><div class="line"></div><div class="line">    @expose(&apos;/second_page&apos;)</div><div class="line">    @login_required</div><div class="line">    @admin_permission.require(http_exception=403)</div><div class="line">    def second_page(self):</div><div class="line">        return self.render(&apos;admin/second_page.html&apos;)</div></pre></td></tr></table></figure>
<p>这个类名就是默认的路由的名字（localhost:5000/admin/customview/）了，还可以定义更多的子路由，定义的方法就是使用 expose 装饰器。</p>
<p>注意这里必须要有一个暴露‘/’路由的方法来作为选项的根路径。</p>
<p>为了保持风格的统一性，我们的模板也应该继承 Flask Admin 的默认样式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;% extends &apos;admin/master.html&apos; %&#125;</div><div class="line">&#123;% block body %&#125;</div><div class="line">    Test custom view.</div><div class="line">    &lt;a href=&quot;&#123;&#123; url_for(&apos;.second_page&apos;) &#125;&#125;&quot;&gt;Link&lt;/a&gt;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p>基本工作已经做完了，但是要让这些生效，必须在 admin 对象上注册一个 CustomView 的实例，这个是在 create_app 函数中完成的，而不是在 extensions 中。因为渲染管理页面需要用到数据库对象，如果放在 extensions 则可能会发生循环导入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># name 参数用来表示导航条中的文本</div><div class="line">admin.add_view(CustomView(name=&apos;Custom&apos;))</div></pre></td></tr></table></figure>
<h3 id="编写数据库管理页面"><a href="#编写数据库管理页面" class="headerlink" title="编写数据库管理页面"></a>编写数据库管理页面</h3><p>Flask Admin 最强大的地方就是它可以直接管理 SQLAlchemy 模型，让对数据库的操作直接在 GUI 中完成。</p>
<p>完成这样的功能同样也需要在视图函数文件处进行初始化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">from flask_admin.contrib.sqla import ModelView</div><div class="line">from flask_admin.contrib.fileadmin import FileAdmin</div><div class="line"></div><div class="line">class CustomModelView(ModelView):</div><div class="line">    pass</div></pre></td></tr></table></figure>
<p>也要在 create_app 的地方注册，这里要把所需要的表注册进去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">models = [User, Reminder, Post, Role, Comment, Contact, Tag]</div><div class="line"></div><div class="line">for model in models:</div><div class="line">    # category 参数相同的部分就会放在导航栏的同一个下拉菜单中</div><div class="line">    admin.add_view(CustomModelView(model, db.session, category=&apos;Models&apos;))</div></pre></td></tr></table></figure>
<h3 id="编写文件系统管理页面"><a href="#编写文件系统管理页面" class="headerlink" title="编写文件系统管理页面"></a>编写文件系统管理页面</h3><p>除了直接访问数据库内容，Flask Admin 还可以从网页访问服务器的文件系统。</p>
<p>首先也需要在视图函数文件处进行初始化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask_admin.contrib.fileadmin import FileAdmin</div><div class="line"></div><div class="line">class CustomFileAdmin(FileAdmin):</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<p>然后只需要把 CustomFileAdmin 类注册到 admin 中就可以访问了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">admin.add_view(CustomFileAdmin(</div><div class="line">    os.path.join(os.path.dirname(__file__), &apos;static&apos;),</div><div class="line">    &apos;/static/&apos;,</div><div class="line">    name=&apos;Static Files&apos;</div><div class="line">))</div></pre></td></tr></table></figure>
<h3 id="保护-Flask-Admin-的安全"><a href="#保护-Flask-Admin-的安全" class="headerlink" title="保护 Flask Admin 的安全"></a>保护 Flask Admin 的安全</h3><p>既然是 Admin，那自然只有管理员才能访问了，所以我们要加入相应的权限。</p>
<p>首先也应该在自定义路由加入 login_require, admin_permission.require() 装饰器来声明权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class CustomView(BaseView):</div><div class="line">    @expose(&apos;/&apos;)</div><div class="line">    @login_required</div><div class="line">    @admin_permission.require(http_exception=403)</div><div class="line">    def index(self):</div><div class="line">        return self.render(&apos;admin/custom.html&apos;)</div><div class="line"></div><div class="line">    @expose(&apos;/second_page&apos;)</div><div class="line">    @login_required</div><div class="line">    @admin_permission.require(http_exception=403)</div><div class="line">    def second_page(self):</div><div class="line">        return self.render(&apos;admin/second_page.html&apos;)</div></pre></td></tr></table></figure>
<p>再就是在 MobileView 和 FileAdmin 中定义 is_accessible 方法来控制权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class CustomModelView(ModelView):</div><div class="line">    def is_accessible(self):</div><div class="line">        return current_user.is_authenticated and admin_permission.can()</div><div class="line">        </div><div class="line">        </div><div class="line">class CustomFileAdmin(FileAdmin):</div><div class="line">    def is_accessible(self):</div><div class="line">        return current_user.is_authenticated and admin_permission.can()</div></pre></td></tr></table></figure>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>常用的扩展差不多就是这么多了，Flask 的一个强大的地方就是它自定义扩展很容易，所以市面上 Flask 扩展有很多，实现的功能也很全面，就进一步减轻了完成一个 Flask App 的工作量。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Flask-Restful&quot;&gt;&lt;a href=&quot;#Flask-Restful&quot; class=&quot;headerlink&quot; title=&quot;Flask-Restful&quot;&gt;&lt;/a&gt;Flask-Restful&lt;/h2&gt;&lt;p&gt;具体内容参考之前的&lt;a href=&quot;https://
    
    </summary>
    
      <category term="Python" scheme="https://blog.patrickcty.cc/categories/Python/"/>
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/categories/Python/Flask/"/>
    
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/tags/Flask/"/>
    
      <category term="Cache" scheme="https://blog.patrickcty.cc/tags/Cache/"/>
    
      <category term="Admin" scheme="https://blog.patrickcty.cc/tags/Admin/"/>
    
  </entry>
  
  <entry>
    <title>Flask常用扩展用法</title>
    <link href="https://blog.patrickcty.cc/2017/09/18/Flask%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E7%94%A8%E6%B3%95/"/>
    <id>https://blog.patrickcty.cc/2017/09/18/Flask常用扩展用法/</id>
    <published>2017-09-18T15:21:51.000Z</published>
    <updated>2017-09-18T15:23:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Flask-SQLAlchemy"><a href="#Flask-SQLAlchemy" class="headerlink" title="Flask-SQLAlchemy"></a>Flask-SQLAlchemy</h2><p>强大的 ORM 工具，让对数据库的操作变得简单。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask_sqlalchemy import SQLAlchemy</div><div class="line"></div><div class="line">db = SQLAlchemy()</div><div class="line">db.init_app(app)</div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 根据实际的数据库类型来确定 URI</div><div class="line">SQLALCHEMY_DATABASE_URI = &apos;sqlite:///&apos; + os.path.join(basedir, &apos;dev.sqlite&apos;)</div><div class="line">SQLALCHEMT_ECHO = True  # 可选</div><div class="line">SQLALCHEMY_TRACK_MODIFICATIONS = True  # 需要显式指明</div></pre></td></tr></table></figure>
<h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class Role(db.Model):</div><div class="line">    id = db.Column(db.Integer, primary_key=True)</div><div class="line">    name = db.Column(db.String(80), unique=True)</div><div class="line">    description = db.Column(db.String(255))</div><div class="line"></div><div class="line">    def __init__(self, name=&apos;default&apos;):</div><div class="line">        self.name = name</div><div class="line"></div><div class="line">    def __repr__(self):</div><div class="line">        return &apos;&lt;Role &#123;&#125;&gt;&apos;.format(self.name)</div></pre></td></tr></table></figure>
<h3 id="操作数据库"><a href="#操作数据库" class="headerlink" title="操作数据库"></a>操作数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">db.create_all()</div><div class="line">db.session.query()</div><div class="line">db.session.add()</div><div class="line">db.session.commit()</div><div class="line">db.session.flush()</div><div class="line">db.drop_all()</div></pre></td></tr></table></figure>
<h2 id="Flask-Login"><a href="#Flask-Login" class="headerlink" title="Flask-Login"></a>Flask-Login</h2><p>好用的登录控制扩展，功能全面并且强大。</p>
<h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">from flask-login import LoginManger</div><div class="line"></div><div class="line">login_manger.login_view = &apos;main.login&apos;</div><div class="line">login_manger.session_protection = &apos;strong&apos;</div><div class="line">login_manger.login_message = &apos;请登录以访问该页面&apos;</div><div class="line">login_manger.login_message_category = &apos;info&apos;</div><div class="line"></div><div class="line">login_manger.init_app(app)</div></pre></td></tr></table></figure>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>需要在用户类里面实现特定的方法，或直接继承 UserMixin，注意如果用户的主键不是 id 则要自己实现 user_loader() 方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">from flask_login import UserMixin, AnonymousUserMixin</div><div class="line"></div><div class="line">class User(db.Model, UserMixin):</div><div class="line">    id = db.Column(db.Integer, primary_key=True)</div><div class="line">    username = db.Column(db.String(255))</div><div class="line">    password = db.Column(db.String(255))</div><div class="line">    </div><div class="line"></div><div class="line">class AnonymousUser(AnonymousUserMixin):</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<h3 id="作为函数的装饰器"><a href="#作为函数的装饰器" class="headerlink" title="作为函数的装饰器"></a>作为函数的装饰器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@main_blueprint.route(&apos;/logout&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])</div><div class="line">@login_required</div><div class="line">def logout():</div><div class="line">    logout_user()</div><div class="line">    flash(&apos;登出成功！&apos;, category=&apos;success&apos;)</div><div class="line">    return redirect(url_for(&apos;blog.home&apos;))</div></pre></td></tr></table></figure>
<h3 id="登入登出"><a href="#登入登出" class="headerlink" title="登入登出"></a>登入登出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">login_user(user, remember=form.remember_me.data)</div><div class="line">logout_user()</div></pre></td></tr></table></figure>
<h3 id="获得当前用户对象"><a href="#获得当前用户对象" class="headerlink" title="获得当前用户对象"></a>获得当前用户对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">from flask-login import current_user</div></pre></td></tr></table></figure>
<p>在 Jinja2 模板中可以直接调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; current_user.name &#125;&#125;</div></pre></td></tr></table></figure>
<h2 id="Flask-Bcrypt"><a href="#Flask-Bcrypt" class="headerlink" title="Flask-Bcrypt"></a>Flask-Bcrypt</h2><p>用来生成和检查加密字符串，常用作密码管理。</p>
<h3 id="初始化-2"><a href="#初始化-2" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from flask-bcrypt import Bcrypt</div><div class="line"></div><div class="line">bcrypt = Bcrypt()</div><div class="line">bcrypt.init_app(app)</div></pre></td></tr></table></figure>
<h3 id="生成与检验密码"><a href="#生成与检验密码" class="headerlink" title="生成与检验密码"></a>生成与检验密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># property 装饰器将方法封装成了属性</div><div class="line">@property</div><div class="line">def passwd(self):</div><div class="line">    raise AttributeError(&apos;密码不可读！&apos;)</div><div class="line"></div><div class="line"># 通过下面的方法来实现直接对“属性”赋值</div><div class="line"># self.passwd = &apos;aaa&apos;</div><div class="line">@passwd.setter</div><div class="line">def passwd(self, password):</div><div class="line">    # 生成密码</div><div class="line">    self.password = bcrypt.generate_password_hash(password)</div><div class="line"></div><div class="line">def verify_password(self, password):</div><div class="line">    # 检验密码</div><div class="line">    return bcrypt.check_password_hash(self.password, password)</div></pre></td></tr></table></figure>
<h2 id="Flask-Principal"><a href="#Flask-Principal" class="headerlink" title="Flask-Principal"></a>Flask-Principal</h2><p>权限管理扩展。</p>
<h3 id="基本概念介绍"><a href="#基本概念介绍" class="headerlink" title="基本概念介绍"></a>基本概念介绍</h3><h4 id="Identity"><a href="#Identity" class="headerlink" title="Identity"></a>Identity</h4><p>Identity 用来表示身份，而 Need 是 Identity 的一部分，用来表示具体的权限。</p>
<p>Identity 一般在身份状态改变的时候创建，此时也会发出 identity_loaded 的信号，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">identity_changed.send(current_app._get_current_object(),</div><div class="line">                      identity=Identity(user.id))</div></pre></td></tr></table></figure>
<p>Identity 使用用户的 id 来表示用户以及创建对象。</p>
<h4 id="Need"><a href="#Need" class="headerlink" title="Need"></a>Need</h4><p>Need 如上面所说是用来表示具体的权限，是用 namedtuple 来实现的。</p>
<p>namedtuple 是 Python collections 模块中的一个数据结构，实现类似 C 语言中 struct 的作用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from collections import namedtuple</div><div class="line">&gt;&gt;&gt; MyNT = namedtuple(&apos;tuple_name&apos;, [&apos;attr1&apos;, &apos;attr2&apos;])</div><div class="line">&gt;&gt;&gt; MyNT.__name__</div><div class="line">&apos;tuple_name&apos;</div><div class="line">&gt;&gt;&gt; nt = MyNT(&apos;this is the first attr&apos;, &apos;hello&apos;)</div><div class="line">&gt;&gt;&gt; nt.attr1</div><div class="line">&apos;this is the first attr&apos;</div></pre></td></tr></table></figure>
<p>Need 的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Need = namedtuple(&apos;Need&apos;, [&apos;method&apos;, &apos;value&apos;])</div></pre></td></tr></table></figure>
<p>Need 一般是 tuple，之后在 Permission 初始化的时候会被转换为 set，set 的基本元素是 Need。</p>
<p>UserNeed 和 RoleNeed 是 Need 的两种典型的表现形式，前者用 user id 来表示 method（个人感觉和 Identity 有些重叠），后者用 role 表示 method 作为权限。它们使用 Python 的 functools 中的 partial 来固定了 Need 的 method。</p>
<p>partial 一般用来固定函数的某个参数的值，产生一个偏函数，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; pow(2, 3)</div><div class="line">8</div><div class="line">&gt;&gt;&gt; from functools import partial</div><div class="line">&gt;&gt;&gt; my_pow = partial(pow, 2)  # 固定了 2 作为了 pow 的第一个参数</div><div class="line">&gt;&gt;&gt; my_pow(5)</div><div class="line">32</div></pre></td></tr></table></figure>
<p>RoleNeed 和 UserNeed 就是这样产生的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RoleNeed = partial(Need, &apos;role&apos;)</div><div class="line">UserNeed = partial(Need, &apos;id&apos;)</div></pre></td></tr></table></figure>
<h4 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h4><p>Permission 用来表示权限，和具体的 Identity 无关，但是可以用来判断当前的 Identity 是否具有相应的权限。</p>
<p>Permission 使用 Need 来初始化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">admin_permission = Permission(RoleNeed(&apos;admin&apos;))</div><div class="line">poster_permission = Permission(RoleNeed(&apos;poster&apos;))</div><div class="line">default_permission = Permission(RoleNeed(&apos;default&apos;))</div></pre></td></tr></table></figure></p>
<p>使用 can() 方法来检测当前用户是否具有相应的权限。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if not admin_permission.can():</div><div class="line">    abort(403)</div></pre></td></tr></table></figure></p>
<h4 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h4><p>使用 Permission 表示权限，Identity 表示用户，用户所拥有的权限用 Need 来表示，通过 Permission 来检测 Identity 里面是否具有相应的 Need 来判断这个用户是否有相应的权限。</p>
<h3 id="初始化-3"><a href="#初始化-3" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">from flask_principal import Principal, Permission, RoleNeed, identity_loaded()</div><div class="line"></div><div class="line">principals = Principal()</div><div class="line"># 定义了三种权限</div><div class="line">admin_permission = Permission(RoleNeed(&apos;admin&apos;))</div><div class="line">poster_permission = Permission(RoleNeed(&apos;poster&apos;))</div><div class="line">default_permission = Permission(RoleNeed(&apos;default&apos;))</div><div class="line"></div><div class="line">principals.init_app(app)</div><div class="line"></div><div class="line"># 当接收到 identity_loaded 信号时会被调用</div><div class="line"># 此时会将 Need 添加到相应的身份对象中</div><div class="line">@identity_loaded.connect_via(app)</div><div class="line">def on_identity_loaded(sender, identity):</div><div class="line">    identity.user = current_user</div><div class="line"></div><div class="line">    if hasattr(current_user, &apos;id&apos;):</div><div class="line">        identity.provides.add(UserNeed(current_user.id))</div><div class="line"></div><div class="line">    if hasattr(current_user, &apos;roles&apos;):</div><div class="line">        for role in current_user.roles:</div><div class="line">            identity.provides.add(RoleNeed(role.name))</div></pre></td></tr></table></figure>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>作为装饰器或者直接调用 can() 方法来判断。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@blog_print.route(&apos;/edit/&lt;int:post_id&gt;&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])</div><div class="line"># 没有 poster 权限无法访问</div><div class="line">@poster_permission.require(http_exception=403) </div><div class="line">@login_required</div><div class="line">def edit_post(post_id):</div><div class="line"></div><div class="line">    post = Post.query.get_or_404(post_id)</div><div class="line">    # 这个权限表示只有创建者才能访问</div><div class="line">    permission = Permission(UserNeed(post.user_id))</div><div class="line">    # 如果不是作者而是管理员则也可以访问</div><div class="line">    if not (permission.can() or admin_permission.can()):</div><div class="line">        abort(403)</div><div class="line"></div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><h4 id="Identity-1"><a href="#Identity-1" class="headerlink" title="Identity"></a>Identity</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">class Identity(object):</div><div class="line">    &quot;&quot;&quot;Represent the user&apos;s identity.</div><div class="line"></div><div class="line">    :param id: The user id</div><div class="line">    :param auth_type: The authentication type used to confirm the user&apos;s</div><div class="line">                      identity.</div><div class="line"></div><div class="line">    The identity is used to represent the user&apos;s identity in the system. This</div><div class="line">    object is created on login, or on the start of the request as loaded from</div><div class="line">    the user&apos;s session.</div><div class="line"></div><div class="line">    Once loaded it is sent using the `identity-loaded` signal, and should be</div><div class="line">    populated with additional required information.</div><div class="line"></div><div class="line">    Needs that are provided by this identity should be added to the `provides`</div><div class="line">    set after loading.</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    def __init__(self, id, auth_type=None):</div><div class="line">        self.id = id</div><div class="line">        self.auth_type = auth_type</div><div class="line">        self.provides = set()</div><div class="line"></div><div class="line">    def can(self, permission):</div><div class="line">        &quot;&quot;&quot;Whether the identity has access to the permission.</div><div class="line"></div><div class="line">        :param permission: The permission to test provision for.</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        return permission.allows(self)</div><div class="line"></div><div class="line"></div><div class="line">class AnonymousIdentity(Identity):</div><div class="line">    &quot;&quot;&quot;An anonymous identity&quot;&quot;&quot;</div><div class="line"></div><div class="line">    def __init__(self):</div><div class="line">        Identity.__init__(self, None)</div></pre></td></tr></table></figure>
<p>Identity 接受 user id 作为参数，provides 属性是和 Permission 类似都是一个用来储存 Need 的 set，其中 provides 的内容在切换身份的时候添加。</p>
<p>Identity 可以使用 can() 方法来判断该 Identity 是否具有相应的权限，这个方法接受一个 Permission 来作为参数，实际上直接调用 Permission 的方法来检查权限。</p>
<p>而匿名 Identity 则是 id 为空的特殊 Identity。</p>
<h4 id="IdentityContext"><a href="#IdentityContext" class="headerlink" title="IdentityContext"></a>IdentityContext</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">class IdentityContext(object):</div><div class="line">    &quot;&quot;&quot;The context of an identity for a permission.</div><div class="line"></div><div class="line">    .. note:: The principal is usually created by the flaskext.Permission.require method</div><div class="line">              call for normal use-cases.</div><div class="line"></div><div class="line">    The principal behaves as either a context manager or a decorator. The</div><div class="line">    permission is checked for provision in the identity, and if available the</div><div class="line">    flow is continued (context manager) or the function is executed (decorator).</div><div class="line">    &quot;&quot;&quot;</div><div class="line"></div><div class="line">    def __init__(self, permission, http_exception=None):</div><div class="line">        self.permission = permission</div><div class="line">        self.http_exception = http_exception</div><div class="line">        &quot;&quot;&quot;The permission of this principal</div><div class="line">        &quot;&quot;&quot;</div><div class="line"></div><div class="line">    @property</div><div class="line">    def identity(self):</div><div class="line">        &quot;&quot;&quot;The identity of this principal</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        return g.identity</div><div class="line"></div><div class="line">    def can(self):</div><div class="line">        &quot;&quot;&quot;Whether the identity has access to the permission</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        return self.identity.can(self.permission)</div></pre></td></tr></table></figure>
<p>IdentityContext 通常通过 Permission.require() 方法来创建，它接受 Permission 作为参数，绑定的 Identity 是当前用户的 Identity（通过 g 来实现）。</p>
<h4 id="Permission-1"><a href="#Permission-1" class="headerlink" title="Permission"></a>Permission</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">class Permission(object):</div><div class="line">    &quot;&quot;&quot;Represents needs, any of which must be present to access a resource</div><div class="line"></div><div class="line">    :param needs: The needs for this permission</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    def __init__(self, *needs):</div><div class="line">        &quot;&quot;&quot;A set of needs, any of which must be present in an identity to have</div><div class="line">        access.</div><div class="line">        &quot;&quot;&quot;</div><div class="line"></div><div class="line">        self.needs = set(needs)</div><div class="line">        self.excludes = set()</div><div class="line"></div><div class="line">    def require(self, http_exception=None):</div><div class="line">        &quot;&quot;&quot;Create a principal for this permission.</div><div class="line"></div><div class="line">        The principal may be used as a context manager, or a decroator.</div><div class="line"></div><div class="line">        If ``http_exception`` is passed then ``abort()`` will be called</div><div class="line">        with the HTTP exception code. Otherwise a ``PermissionDenied``</div><div class="line">        exception will be raised if the identity does not meet the</div><div class="line">        requirements.</div><div class="line"></div><div class="line">        :param http_exception: the HTTP exception code (403, 401 etc)</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        return IdentityContext(self, http_exception)</div><div class="line"></div><div class="line">    def allows(self, identity):</div><div class="line">        &quot;&quot;&quot;Whether the identity can access this permission.</div><div class="line"></div><div class="line">        :param identity: The identity</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        if self.needs and not self.needs.intersection(identity.provides):</div><div class="line">            return False</div><div class="line"></div><div class="line">        if self.excludes and self.excludes.intersection(identity.provides):</div><div class="line">            return False</div><div class="line"></div><div class="line">        return True</div><div class="line"></div><div class="line">    def can(self):</div><div class="line">        &quot;&quot;&quot;Whether the required context for this permission has access</div><div class="line"></div><div class="line">        This creates an identity context and tests whether it can access this</div><div class="line">        permission</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        return self.require().can()</div></pre></td></tr></table></figure>
<p>Permission 可以说是最关键的部分了，它接受 Need 的 list 作为参数，并将其转换为 set 来储存所有的权限。为什么是 set 呢？因为 set 不可重复，并且做集合运算很容易直到是否存在某个 Need。</p>
<p>它的 require() 方法是使用得最多的方法之一，在调用这个方法的时候会创建一个 IdentityContext 实例，它会调用 IdentityContext.__enter__() 方法来检查权限，而这个方法里面又要调用 IdentityContext.can() 方法，这个方法又调用了相应的 Identity 对应的 Identity.can() 方法，并且传入当前 Identity 含有的权限作为参数。Identity 又调用 Permission.allows() 方法来检查权限，而这个方法则把 Permission 所具有的 Need 的 set 和 Identity.provides 这个 set 来做集合交运算来判断是否有相应的权限。（调用了一大圈，汗）</p>
<p>而 Permission.can() 的用法和上面的几乎一样。不过不同的是 require() 方法一般被用作装饰器，而 can() 方法一般用来直接进行判断。</p>
<h3 id="Principal-总结"><a href="#Principal-总结" class="headerlink" title="Principal 总结"></a>Principal 总结</h3><p>不得不说整个扩展设计得还是非常不错的，各个模块的逻辑性很强，只是太难理解了……我前前后后看了两遍……这次才终于搞清楚前前后后的逻辑了……</p>
<p>果然还是要看源代码，话说源代码写得还真不错，不仅文档详实，代码真的超级规范！</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Flask-SQLAlchemy&quot;&gt;&lt;a href=&quot;#Flask-SQLAlchemy&quot; class=&quot;headerlink&quot; title=&quot;Flask-SQLAlchemy&quot;&gt;&lt;/a&gt;Flask-SQLAlchemy&lt;/h2&gt;&lt;p&gt;强大的 ORM 工具，让对数
    
    </summary>
    
      <category term="Python" scheme="https://blog.patrickcty.cc/categories/Python/"/>
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/categories/Python/Flask/"/>
    
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/tags/Flask/"/>
    
      <category term="SQLAlchemy" scheme="https://blog.patrickcty.cc/tags/SQLAlchemy/"/>
    
      <category term="Principal" scheme="https://blog.patrickcty.cc/tags/Principal/"/>
    
      <category term="Login" scheme="https://blog.patrickcty.cc/tags/Login/"/>
    
  </entry>
  
  <entry>
    <title>《爆漫王》</title>
    <link href="https://blog.patrickcty.cc/2017/09/17/%E3%80%8A%E7%88%86%E6%BC%AB%E7%8E%8B%E3%80%8B/"/>
    <id>https://blog.patrickcty.cc/2017/09/17/《爆漫王》/</id>
    <published>2017-09-17T06:34:49.000Z</published>
    <updated>2017-09-17T06:38:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>梦想，多么熟悉又陌生的一个词。对我来说，这个词似乎从来都没有存在过。</p>
<p>小学时候的“梦想”是成为天文学家，但这只是一个听起来很厉害的职业，而同期的小伙伴们很多选择的是同样炫酷的科学家、医生……这个所谓的梦想的作用也只是在亲戚和老师问到之后的一个回答而已。</p>
<p>而天文学家最接近梦想的一次是爸爸给我买天文望远镜，但是因为我没有太大的兴趣，所以天文望远镜也只用过一次就永远躺在老屋黑暗的顶楼中了。之后这个“梦想”就像那个崭新的天文望远镜一样湮没在尘埃之中了。</p>
<p>初中和高中本应该是大谈理想与未来的时刻，但是在深井中哪看得到什么理想，更何况背上还压着重担。在这样的情况下，大家都是一样，所谓的梦想，被简化成了目标，而目标，则被固化成了取得好成绩。</p>
<p>而我就在大流中漂着，偶尔也有人问过梦想，但是我的回答是不存在。</p>
<p>也不知道什么时候开始，整个社会，特别是青年一代，都开始追逐财富。“最大的梦想是一夜暴富”这种话也多次从我口中说出，但是真正暴富又怎样呢？这个我也从未认真想过，或许也只是因为欲望吧。</p>
<p>追求财富其实也是一个好梦想，但是好的梦想背后总有一个意义，而财富的意义确是那么空虚。所以这与其来说是一个梦想，倒不如说是一种焦虑，一种因为内心空虚缺乏梦想的焦虑。</p>
<p>高中毕业之后，背上的重担终于解除，离开井底也就是理所应当的了。其实很多时候人们一直待在井底并不是因为背上的重担，就像大象会被拴在木桩上并不是因为绳子。真正让我一直待在井底的原因在于我不知道外面有更广阔的世界，也没有机会能接触到。而上大学，让我被动着离开井底，虽然这之前我从来不知道我一直待在井底。</p>
<p>正是在这个过程中我才知道原来生活不仅仅只有成绩，兴趣不仅仅只有篮球动漫。虽然视野拓宽了，但是梦想似乎还是没有萌生，不过走着走着，总算是有了目标，而目标之后的梦想，却宛若缥缈云烟一般，仍然不可触及。</p>
<p>海贼王是一部有梦想的动漫，也是陪我从高中走到现在的动漫。路飞的梦想是成为海贼王，索隆的梦想是成为世界第一的大剑豪，娜美的梦想是画出整个世界的航海图，乌索普的梦想是成为勇敢的海上勇士，山治的梦想是找到 All Blue，罗宾的梦想是追寻历史的真相，乔巴的梦想是成为万能药，弗兰奇的梦想是看到自己造的船达到世界的尽头，而布鲁克的梦想则是再次与拉布见面。</p>
<p>每个人都有梦想，他们也在实现梦想的途中努着力，接受着嘲笑，但也是因为海贼的世界设计的太过精妙，反而没能激励我去现实世界寻找、实现梦想。而我最近看的《爆漫王》却是这种能让人充满干劲，甚至开始思考梦想的一部极其优秀的作品。</p>
<p>曾经男主真诚最高也是一名没有梦想的中学生，每天回家靠打游戏来挥霍时间，在学校里面有不高不低的成绩，暗恋一个从未说过话的女生。但是一个已经拥有并且准备追求梦想的人——高木秋人的出现改变了他的一生。<br>他们和女主一起确定了梦想：两人合作画出漫画，等到作品动画化之后最高就和女主亚豆结婚。</p>
<p>动画的第一季主要是讲述主角确定梦想并且开始向梦想奋斗的故事，其中不仅有欢笑，更多是对梦想的万分执着。两个年仅十四岁的少年，就已经有了人生奋斗的目标，并且和平常人不同的是，他们在这之后就全力追求目标了，连一秒钟都不浪费。真诚练习画画，高木写原作 NAME，很多人都会戏称《爆漫王》为《爆肝王》，因为他们真的太努力了。他们就这样一直奋斗着，接近着目标，从提名到刊载到这一季最后的连载，他们一步步在向那个梦想靠近。</p>
<p>个人认为第一季是整部剧最燃的一季，在这里我们和主角他们一起从零开始一起奋斗一起提心吊胆、分享喜悦，真的让人有一种马上去学习的欲望。</p>
<p>第二季同样精彩，但是这一季整体节奏没有第一步那么明快，颇有几分压抑的气息。那是因为梦想实现的过程总不总是一帆风顺，总是会有各种各样的挫折。</p>
<p>而主角他们遇到的第一个大的挫折就是首部连载作品因为真诚的“爆肝”而不得不长时间休刊，等到最后恢复的时候已经人气下降被腰斩。之后又因为责编的原因不得不去画他们所不喜欢且不擅长的搞笑漫画，也因此他们的作品的名次一直在一个很令人尴尬的位置。在这一季最后，他们勇敢地选择结束连载，并在重重困难之下完成了新的作品，通过了编辑部的挑战。</p>
<p>这一季看的时候感觉十分揪心，就像《牧羊少年》里面说的那样，梦想是以初行者的运气开始，而到了后面就成为了对旅行者的考验。这时候的真诚他们也是迈入了后一个阶段，其中令人印象深刻的是真诚在医院中挣扎着画画的场景，这种对梦想的执着真的是无人能及了。</p>
<p>除此之外，第二季中友谊这个概念也变得更加深入，除了真诚和高木的革命友谊之外，同为福田组的新妻英二、福田先生、中井先生、苍树红等这些人物与主角的友情也表现得淋漓尽致，虽然他们是对手，但同时也是伙伴，正是有了他们相互的支持，这一季才不会让人感觉过于压抑。</p>
<p>说到这些其他的角色，就不得不说这部动漫的另一个亮点了——人物刻画。主人公一行人就不用说了，一群志同道合又个性鲜明的作者，一群性格迥异却又敬业的编辑，全都是“圆形人物”，人物的个性都被表现得淋漓尽致。</p>
<p>其中最让人喜欢的莫过于直爽天真又天赋异禀的新妻英二，他虽然是天才但是并没有天才的架子，反而是一个非常让人亲近的人，也正是抱着超过他的态度，主角他们才能一次一次奋斗，画出更好的作品。而编辑的角色中服部先生最让人喜爱，不仅是因为他直爽的性格与笑声，更是因为他的敬业与真性情，他会为了作者而开心与难受，和他们一起奋斗，正是有了他才让亚城木梦叶他们能走在正确的道路上接近梦想。</p>
<p>而第三季的剧情就比第二季明快不少，但是少了第一季的跌宕起伏，不过剧情的精彩程度还是无可挑剔的。这一季主人公终于走出低谷，大放异彩，最终实现了梦想。</p>
<p>看到最后的时候不禁让人感到落寞，短短的一段时间，就见证了主角他们十年的努力。看的时候希望他们能早日实现梦想，但是当真正实现了梦想的时候却也是不得不说再见的时候了。虽然剧情到这里就结束了，但是这部动漫让我陷入了思考——我的梦想到底是什么？</p>
<p>想来想去，虽然我没有真诚那样明确的梦想，动画化，结婚。但是我也有一个阶段一个阶段的目标，从最近的跟着导师搞科研，到之后的考研上中山大学。和主角相比，我对梦想的执着程度还是太低，这也是我一直以来最大的问题。我无法像主角那样一直专注于梦想，但是看过这部动漫之后我也有了行动，我放弃掉了一些占用很多时间的无意义的内容，比如花大量时间看对我没什么用的手机评测以及肝得很累的崩坏 3。</p>
<p>我想，等我以后觉得很累想放弃的时候我就会再次拾起这部动漫重新找回向前奋斗的勇气吧！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;梦想，多么熟悉又陌生的一个词。对我来说，这个词似乎从来都没有存在过。&lt;/p&gt;
&lt;p&gt;小学时候的“梦想”是成为天文学家，但这只是一个听起来很厉害的职业，而同期的小伙伴们很多选择的是同样炫酷的科学家、医生……这个所谓的梦想的作用也只是在亲戚和老师问到之后的一个回答而已。&lt;/p&gt;
    
    </summary>
    
      <category term="动画" scheme="https://blog.patrickcty.cc/categories/%E5%8A%A8%E7%94%BB/"/>
    
    
      <category term="感动" scheme="https://blog.patrickcty.cc/tags/%E6%84%9F%E5%8A%A8/"/>
    
      <category term="梦想" scheme="https://blog.patrickcty.cc/tags/%E6%A2%A6%E6%83%B3/"/>
    
      <category term="友谊" scheme="https://blog.patrickcty.cc/tags/%E5%8F%8B%E8%B0%8A/"/>
    
      <category term="欢乐" scheme="https://blog.patrickcty.cc/tags/%E6%AC%A2%E4%B9%90/"/>
    
  </entry>
  
  <entry>
    <title>再次理解 Flask 中 Celery 的用法（二）</title>
    <link href="https://blog.patrickcty.cc/2017/09/03/%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Flask%E4%B8%ADCelery%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://blog.patrickcty.cc/2017/09/03/再次理解Flask中Celery的用法（二）/</id>
    <published>2017-09-03T02:58:34.000Z</published>
    <updated>2017-09-03T03:00:13.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="再次理解-Flask-中-Celery-的用法（二）"><a href="#再次理解-Flask-中-Celery-的用法（二）" class="headerlink" title="再次理解 Flask 中 Celery 的用法（二）"></a>再次理解 Flask 中 Celery 的用法（二）</h1><h2 id="运行-Celery-task"><a href="#运行-Celery-task" class="headerlink" title="运行 Celery task"></a>运行 Celery task</h2><p>我们之前都是用 Celery task 的 delay() 方法来运行任务，但是这只是 apply_async 方法的简略版本，后者的使用方法如下：</p>
<p>使用方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">task.apply_async(</div><div class="line">    args=[1, 2],  # 可选，表示参数列表，是一个 list</div><div class="line">    kwargs=&#123;&apos;kwarg1&apos;: &apos;1&apos;, &apos;kwarg2&apos;: &apos;2&apos;&#125;,</div><div class="line">    # countdown 表示指定秒数后后开始处理这个任务</div><div class="line">    # 不是一定在那个时候执行，要根据其他任务来定</div><div class="line">    countdown=600,</div><div class="line">    # eta 表示指定时间开始处理这个任务</div><div class="line">    # 执行时间和 countdown 一样不完全可靠</div><div class="line">    # 我用这个参数来发邮件结果第二天才发出去……</div><div class="line">    eta=datetime.datime.now() + datetime.timedelta(hours=1)</div><div class="line">)</div></pre></td></tr></table></figure>
<h2 id="Celery-签名-子任务"><a href="#Celery-签名-子任务" class="headerlink" title="Celery 签名/子任务"></a>Celery 签名/子任务</h2><p>签名可以把 task 生成函数来便于其他的函数进行调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from celery import signature</div><div class="line">&gt;&gt;&gt; from webapp.tasks import multiply</div><div class="line"># signature 的第一个参数要写全</div><div class="line">&gt;&gt;&gt; signature(&apos;webapp.tasks.multiply&apos;, args=[4, 4], countdown=10)</div><div class="line">webapp.tasks.multiply(4, 4)  # 返回的是一个函数</div><div class="line"># 和上面相同的功能</div><div class="line">&gt;&gt;&gt; multiply.subtask((4, 4), countdown=10)</div><div class="line">webapp.tasks.multiply(4, 4)</div><div class="line"># 上面的缩略版本，没有关键字参数</div><div class="line">&gt;&gt;&gt; multiply.s(4, 4)</div><div class="line">webapp.tasks.multiply(4, 4)</div><div class="line">&gt;&gt;&gt; multiply.s(4, 4)()  # 调用函数</div><div class="line">16</div><div class="line">&gt;&gt;&gt; multiply.s(4, 4).delay()  # 创建任务</div></pre></td></tr></table></figure>
<h2 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h2><p>Celery 任务签名的第一个应用是偏函数。偏函数来源于一个要接受很多参数的函数，这个函数被施加某种操作之后，生成了一个新的函数，在调用这个函数的时候，前 n 个参数永远是一样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; partial = multiply.s(4)  # 第一个参数永远是 4</div><div class="line">&gt;&gt;&gt; partial(5)</div><div class="line">20</div><div class="line">&gt;&gt;&gt; partial.delay(5)</div></pre></td></tr></table></figure>
<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>回调函数就是根据前一个任务执行的结果来执行的函数。在 apply_async() 中使用 link 参数来添加回调函数。</p>
<p>这个执行任务返回的值并不是回调函数的结果，而是前一个任务执行的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># link 接受一个签名作为参数</div><div class="line"># log 接受 multiply 的结果作为参数</div><div class="line"># 这里是建立了两个 task，并且返回值都是 16</div><div class="line">&gt;&gt;&gt; multiply.apply_async((4, 4), link=log.s())</div><div class="line"># 如果回调函数不接受输入或者不需要上一个任务的结果</div><div class="line"># 那么签名必须使用 si 方法（设置为不可变类型）</div><div class="line"># 结果为 16 而不是 hello</div><div class="line">&gt;&gt;&gt; multiply.apply_async((4, 4), link=log.si(&apos;hello&apos;))</div></pre></td></tr></table></figure>
<p>回调函数常常用来做两个联系紧密的任务，比如每次创建用户的任务之后都发送一封欢迎 email。</p>
<p>偏函数也可以和回调函数一起用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; multiply.apply_async((4, 4), link=multiply.s(4))</div></pre></td></tr></table></figure>
<h2 id="任务组"><a href="#任务组" class="headerlink" title="任务组"></a>任务组</h2><p>任务组函数接受一组任务签名的列表，并生成一个函数，调用该函数可并行执行所有的任务签名，并返回所有结果的列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from celery import group</div><div class="line">&gt;&gt;&gt; sig = group(multiply.s(i, i + 5) for i in range(10))</div><div class="line">&gt;&gt;&gt; rst = sig.delay()</div><div class="line">&gt;&gt;&gt; rst.get()</div><div class="line">[0, 6, 14, 24, 36, 50, 66, 84, 104, 126]</div></pre></td></tr></table></figure>
<h2 id="任务链"><a href="#任务链" class="headerlink" title="任务链"></a>任务链</h2><p>任务链和回调函数有点相像，它接受一组任务签名，把每个签名的执行结果传给任务链的下一个，最后只会返回最后一个的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from celery import chain</div><div class="line"># 事实上也是创建了多个任务，但是只会返回最终的结果</div><div class="line">&gt;&gt;&gt; sig = chain(multiply.s(10, 10), multiply.s(10), multiply.s(10))</div><div class="line"># 另一种写法</div><div class="line">&gt;&gt;&gt; sig = (multiply.s(10, 10) | multiply.s(10) | multiply.s(10))</div></pre></td></tr></table></figure>
<p>任务链也可以用来组合偏函数生成新的偏函数，这样的话任务链也可以嵌套了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; func = (multiply.s(10) | multiply.s(10))</div><div class="line">&gt;&gt;&gt; rst = func.delay(16)</div><div class="line">&gt;&gt;&gt; rst.get()</div><div class="line">1600</div></pre></td></tr></table></figure></p>
<h2 id="复合任务"><a href="#复合任务" class="headerlink" title="复合任务"></a>复合任务</h2><p>复合任务是函数生成一个任务签名的时候，会先执行一个任务组，然后把最终结果传给回调函数，最后回调函数的结果就是最终的结果，这里和上面的回调函数部分有些不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from celery import chord</div><div class="line">&gt;&gt;&gt; sig = chord(</div><div class="line">    group(multiply(i, i + 5) for i in range(10)),</div><div class="line">    # 整个任务组执行的结果，也就是回调函数的参数是 list</div><div class="line">    multiply.s(2) </div><div class="line">)</div><div class="line">&gt;&gt;&gt; rst = sig.delay()</div><div class="line">&gt;&gt;&gt; rst.get()</div><div class="line">[0, 6, 14, 24, 36, 50, 66, 84, 104, 126, 0, 6, 14, 24, 36, 50, 66, 84, 104, 126]</div><div class="line"># 还有另一种写法</div><div class="line">&gt;&gt;&gt; sig = (group([0, 6, 14, 24, 36, 50, 66, 84, 104, 126]) | multiply.s(2))</div></pre></td></tr></table></figure>
<h2 id="定期执行任务"><a href="#定期执行任务" class="headerlink" title="定期执行任务"></a>定期执行任务</h2><p>和 Linux 的 cron 命令有点类似，不过这里完全是在 Flask 的上下文中来执行任务的。</p>
<p>要在 config 文件中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CELERY_SCHEDULE = &#123;</div><div class="line">    &apos;log-every-30-seconds&apos;: &#123;</div><div class="line">        &apos;task&apos;: &apos;webapp.tasks.log&apos;,</div><div class="line">        &apos;schedule&apos;: datetime.timedelta(seconds=30),</div><div class="line">        &apos;args&apos;: [&apos;hello&apos;,]</div><div class="line">    &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里是定义了 log 任务每隔 30s 执行一次</p>
<p>如果要运行定期任务，就要使用 Celery 的 beat 工作进程，当然任务也是在 worker 进程中执行的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">celery -A celery_runner beat</div></pre></td></tr></table></figure>
<p>如果要在一个精确的时间执行，那么就要用 crontab 对象了，具体的用法参考 Celery <a href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html#crontab-schedules" target="_blank" rel="external">官方文档</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">from celery.schedules import crontab</div><div class="line"># 每天凌晨</div><div class="line">&gt;&gt;&gt; crontab(minute=0, hour=0)</div><div class="line"># 早上五点，十点，下午三点，八点</div><div class="line">&gt;&gt;&gt; crontab(minute=0, hour=[5, 10, 15, 20])</div></pre></td></tr></table></figure>
<h2 id="在-Flower-中通过网页监控"><a href="#在-Flower-中通过网页监控" class="headerlink" title="在 Flower 中通过网页监控"></a>在 Flower 中通过网页监控</h2><p>Flower 是针对 Celery 的基于网页的试试管理工具。</p>
<p>安装 Flower：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install flower</div></pre></td></tr></table></figure></p>
<p>运行 Flower：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">celery flower -A celery_runner --loglevel=info</div></pre></td></tr></table></figure></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>说实话第一次看到上面这些的时候真的十分头大，一脸懵逼，不过现在回头整理了一遍之后明了了许多，不过要吐槽的是 eta 为什么这么坑啊！</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;再次理解-Flask-中-Celery-的用法（二）&quot;&gt;&lt;a href=&quot;#再次理解-Flask-中-Celery-的用法（二）&quot; class=&quot;headerlink&quot; title=&quot;再次理解 Flask 中 Celery 的用法（二）&quot;&gt;&lt;/a&gt;再次理解 Fla
    
    </summary>
    
      <category term="Python" scheme="https://blog.patrickcty.cc/categories/Python/"/>
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/categories/Python/Flask/"/>
    
    
      <category term="Flask" scheme="https://blog.patrickcty.cc/tags/Flask/"/>
    
      <category term="Web" scheme="https://blog.patrickcty.cc/tags/Web/"/>
    
      <category term="Python" scheme="https://blog.patrickcty.cc/tags/Python/"/>
    
      <category term="Celery" scheme="https://blog.patrickcty.cc/tags/Celery/"/>
    
  </entry>
  
</feed>
